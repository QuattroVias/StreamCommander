<!DOCTYPE html>
<html lang="ru" style="zoom: 0.92;">
<head>
  <meta charset="UTF-8">
  <title>Stream Commander</title>

  <!-- Мета-теги для адаптивности -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <!-- Шрифты и иконки -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,600,700,800" rel="stylesheet">

  <!-- Стили Black Dashboard -->
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="black-dashboard/assets/css/nucleo-icons.css">
  <link rel="stylesheet" href="black-dashboard/assets/css/black-dashboard.css?v=1.0.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<input id="vk-channel-url" type="text" value="mishgan99" />
<input id="twitch-channel-url" type="text" value="streamcommandertv" />
<input id="vlc-volume" type="range" value="35" />
<input id="tts-volume" type="range" value="0.4" />
<input id="max-video-length" type="number" value="480" />
<input id="min-views" type="number" value="2000" />
<input id="chat-width" type="number" value="10" />
<input id="chat-height" type="number" value="1000" />
<input id="chat-widthov" type="number" value="700" />
<input id="chat-heightov" type="number" value="200" />
<input id="chat-timeout" type="number" value="300" />
<input id="chat-limit" type="number" value="6" />

</head>


<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Stream Commander</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .navbar-brand, label, span {
      color: #d9a000 !important;
    }
    .tab-content > .tab-pane {
      display: none;
    }
    .tab-content > .tab-pane.active {
      display: block;
    }
    .nav-tabs .nav-link {
      color: #fff;
      background-color: #2c2c2c;
      border: 1px solid #444;
    }
    .nav-tabs .nav-link.active {
      background-color: #d9a000;
      color: #000;
      font-weight: bold;
    }
    .card {
	  <!-- background-image: linear-gradient(320deg, #2c2c2c, #2d2f35); -->
      background-color: #2c2c2c;
      border: 1px solid #353535;
	  box-shadow: -0.125em -0.125em 0.25em hsl(var(--hue), 10%, 30%), 0.125em 0.125em 0.125em hsl(var(--hue), 10%, 30%) inset, 0.125em 0.125em 0.25em hsl(0, 0%, 0%), -0.125em -0.125em 0.125em hsl(var(--hue), 10%, 5%) inset;
    }
    .form-control, .form-control-range {
      background-color: #333;
      color: #fff;
      border: 1px solid #555;
    }
	
  .style-selector {
    display: flex;
    gap: 12px;
    padding: 2px 14px 0px 0px;
  }

  .style-box:hover {
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
  }

  .style-box[data-style="1"] {
    background-color: #d9a000; 
  }
  .style-box[data-style="2"] {
    background-color: #ae7cf7; 
  }

  .style-tooltip {
    position: absolute;
    bottom: -25px;
    left: 0;
    width: 100%;
    text-align: center;
    color: #333;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .style-box:hover .style-tooltip {
    opacity: 1;
  }
  
  :root {
    --primary-color: #d9a000;
    --primary-color-translucent: #d9a00082;
    --primary-text: #000;
  }

  body {
    background-color: #1e1e1e;
    color: #fff;
    font-family: Arial, sans-serif;
  }

  .navbar-brand, label, span {
    color: var(--primary-color) !important;
  }

  .tab-content > .tab-pane {
    display: none;
  }

  .tab-content > .tab-pane.active {
    display: block;
  }

  .nav-tabs .nav-link {
    color: #fff;
    background-color: #2c2c2c;
    border: 1px solid #444;
  }

  .nav-tabs .nav-link.active {
    background-color: var(--primary-color);
    color: var(--primary-text);
    font-weight: bold;
  }

  .card {
    background-color: #2c2c2c;
    border: 1px solid #353535;
    box-shadow:
      -0.125em -0.125em 0.25em hsl(var(--hue), 10%, 30%),
      0.125em 0.125em 0.125em hsl(var(--hue), 10%, 30%) inset,
      0.125em 0.125em 0.25em hsl(0, 0%, 0%),
      -0.125em -0.125em 0.125em hsl(var(--hue), 10%, 5%) inset;
  }

  .form-control, .form-control-range {
    background-color: #333;
    color: #fff;
    border: 1px solid #555;
  }

.style-box.selected {
  box-shadow:
    0 0 6px 2px var(--primary-color),
    0 0 8px 4px var(--primary-color);
  transform: scale(1.10);
  border: 2px solid var(--primary-color);
  transition: box-shadow 0.2s ease, transform 0.2s ease;
  z-index: 10;
}


/* Синий стиль, похожий на ВК */
.style-box[data-style="3"] {
  background: linear-gradient(135deg, #5181b8, #37598a);
  border-radius: 8px;
}


  .style-box {
    width: 45px;
    height: 25px;
    border-radius: 6px;
    cursor: pointer;
    position: relative;
  transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
              box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
  }

.style-box:hover {
  transform: scale(1.1);
  box-shadow: 0 0 6px rgba(0, 0, 0, 0.6);
}

.style-box[data-style="1"] {
  background-color: var(--primary-color-style-1, #d9a000);
}

.style-box[data-style="2"] {
  background-color: var(--primary-color-style-2, #ae7cf7);
}

.style-box[data-style="3"] {
  background-color: var(--primary-color-style-3, #5181b8);
}

.style-box[data-style="4"] {
  background-color: var(--primary-color-style-4, #00bfa5);
}

.style-box[data-style="5"] {
  background-color: var(--primary-color-style-5, #ff6f61);
}
.style-box[data-style="6"] {
  background-color: var(--primary-color-style-6, #2196f3);
}
.style-box[data-style="7"] {
  background-color: var(--primary-color-style-7, #4caf50);
}
.style-box[data-style="8"] {
  background-color: var(--primary-color-style-8, #e91e63);
}
.style-box[data-style="9"] {
  background-color: var(--primary-color-style-9, #ff7043); /* Яркий оранжевый */
}
.style-box[data-style="10"] {
  background-color: var(--primary-color-style-10, #00796b); /* Зеленовато-синий */
}
.style-box[data-style="11"] {
  background-color: var(--primary-color-style-11, #3f51b5); /* Фиолетовый */
}
.style-box[data-style="12"] {
  background-color: var(--primary-color-style-12, #a1887f); /* Коричневый */
}
.style-box[data-style="13"] {
  background-color: var(--primary-color-style-13, #607d8b); /* Серо-голубой */
}

.style-box:focus-visible {
  outline: 2px solid var(--primary-color);
  outline-offset: 4px;
  transform: scale(1.1);
}

  .style-tooltip {
    position: absolute;
    bottom: -25px;
    left: 0;
    width: 100%;
    text-align: center;
    color: #333;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .style-box:hover .style-tooltip {
    opacity: 1;
  }

  /* Версия в заголовке */
  .navbar-brand.version {
    color: var(--primary-color-translucent) !important;
  }
  
.btn-primary:disabled,
.btn-primary[disabled] {
	box-shadow: inset 2px 2px 2px 0px rgba(255, 255, 255, .5), 7px 7px 20px 0px rgba(0, 0, 0, .1), 4px 4px 5px 0px rgba(0, 0, 0, .1);
    background-color: var(--btn-primary-bg-color);
}


.btn-primary {
  background-color: var(--btn-primary-bg-color);
  background-image: var(--btn-primary-bg-gradient);
  background-size: 130%;
  background-position: top right;
  transition: all 0.15s ease;
  box-shadow: none;
  color: var(--btn-primary-text-color);
  border: none;
}

.btn-primary:hover,
.btn-primary:focus,
.btn-primary:active,
.btn-primary.active,
.btn-primary:active:focus,
.btn-primary:active:hover,
.btn-primary.active:focus,
.btn-primary.active:hover {
  background-color: var(--btn-primary-hover-bg-color);
  background-image: var(--btn-primary-hover-bg-gradient);
  color: var(--btn-primary-hover-text-color);
  box-shadow: none;
}

.btn-primary {
  background-color: var(--btn-primary-bg-color);
  background-image: var(--btn-primary-bg-gradient);
  color: var(--btn-primary-text-color);
  transition: all 0.15s ease;
}

.btn-primary:hover,
.btn-primary:focus,
.btn-primary:active {
  background-color: var(--btn-primary-hover-bg-color) !important;
  background-image: var(--btn-primary-hover-bg-gradient) !important;
  color: var(--btn-primary-hover-text-color) !important;
  box-shadow: none;
}
.cssstyle {
--bs-table-color: var(--btn-primary-bg-color) !important;
}

@font-face {
  font-family: 'MyCustomFont1';
  src: url('black-dashboard/assets/fonts/nucleo.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'MyCustomFont2';
  src: url('black-dashboard/assets/fonts/tf2.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont3';
  src: url('black-dashboard/assets/fonts/tf2secondary.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont4';
  src: url('black-dashboard/assets/fonts/minecraft.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont5';
  src: url('black-dashboard/assets/fonts/barboskinsakzident.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont6';
  src: url('black-dashboard/assets/fonts/LT_55933.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont7';
  src: url('black-dashboard/assets/fonts/DINNextCYR.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'MyCustomFont8';
  src: url('black-dashboard/assets/fonts/PF Playskoo.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont9';
  src: url('black-dashboard/assets/fonts/TwilightC.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont10';
  src: url('black-dashboard/assets/fonts/Verdana.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont11';
  src: url('black-dashboard/assets/fonts/TheCrewPro.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont12';
  src: url('black-dashboard/assets/fonts/KristenITCCyrillic.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont13';
  src: url('black-dashboard/assets/fonts/FoxcroftNF.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont14';
  src: url('black-dashboard/assets/fonts/VHS.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont15';
  src: url('black-dashboard/assets/fonts/KaaosPro.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont16';
  src: url('black-dashboard/assets/fonts/HUNoodles.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'MyCustomFont17';
  src: url('black-dashboard/assets/fonts/GuardianCircusG.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

  </style>
</head>
<body style="zoom: 0.92;" id="zoom-wrapper">


      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top pywebview-drag-region">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <img src="svg/01.png" style="width: 20px;">
			<a class="navbar-brand" href="javascript:void(0)" style="font-weight: 900;padding-left: 6px;"> Stream Commander </a> 
			<a class="navbar-brand version" style="margin-left: -8px;"> (1.0.2)</a>
          </div>
			<div class="window-controls">
			  <button class="window-btn" onclick="window.pywebview.api.minimize()">
				<img src="black-dashboard/01.svg" alt="Minimize">
			  </button>
			  <button class="window-btn" onclick="window.pywebview.api.close()">
				<img src="black-dashboard/02.svg" alt="Close">
			  </button>
			</div>
        </div>
      </nav>
      <!-- End Navbar -->

 
<div class="container-fluid mt-3" style="margin-top: 5% !important;">

  <ul class="nav nav-tabs" id="tabs" style="font-size: 14px; padding-bottom: 2px;">
    <li class="nav-item">
      <a class="nav-link active" href="#settings" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-gear" style="font-size: 21px; display: block; margin-bottom: -5px;"></i>
        Настройки
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#chat" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-chat-dots" style="font-size: 20px; display: block; margin-bottom: -3px;"></i>
        Чат
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#voice" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-volume-up" style="font-size: 23px; display: block; margin-bottom: -8px;"></i>
        Озвучка
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#clips" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-camera-video" style="font-size: 23px; display: block; margin-bottom: -8px;"></i>
        Клипы
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#roles" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-person-badge" style="font-size: 19px; display: block; margin-bottom: -2px;"></i>
        Роли
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#script" id="script-tab" style="text-align:center;">
        <i class="bi bi-terminal" style="font-size: 20px; display: block; margin-bottom: -4px;"></i>
        Скрипты
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#alerts" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-bell" style="font-size: 20px; display: block; margin-bottom: -4px;"></i>
        События
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#reports" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-bar-chart" style="font-size: 20px; display: block; margin-bottom: -4px;"></i>
        Отчеты
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#logs" data-bs-toggle="tab" style="text-align:center;">
        <i class="bi bi-journal-text" style="font-size: 20px; display: block; margin-bottom: -4px;"></i>
        Логи
      </a>
    </li>

  	<button class="btn btn-primary btn-round custom-btn btn-16" id="trackingBtn" onclick="toggleTracking()" 
  	style="width: 12%; height: 46px; font-size: 15px; margin-left: 85%; position: absolute; z-index: 1000;">Запустить</button>
  </ul>

  <div class="tab-content mt-3">

    <!-- Настройки -->
<div class="tab-pane active" id="settings">

    <hr class="my-4">
    <h6 class="mb-3" style="text-align: right;">Ссылки на каналы</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- VK Видео Live-->
        <tr>
          <td style="width: 2%;">
            <img src="svg/vk.png" style="width: 22px; margin-bottom: 4px;">
          </td>
          <td class="text-end" style="width: 28.4%;">
            <label for="vkChannel" class="form-label fw-semibold" style="margin-bottom: 0px; font-size: 16px;">VK Видео Live</label>
          </td>
          <td style="width: 30%;">
            <input type="text" class="form-control" id="vkChannel" onchange="onVkChannelInput(this.value)" style="height: 26px;">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;"> Ссылка на канал [live.vkvideo.ru]</small></td>
        </tr>
        <!-- VK Видео Live-->
        <tr>
          <td>
            <img src="svg/twitch.png" style="width: 22px;">
          </td>
          <td class="text-end">
            <label for="twitchChannel" class="form-label fw-semibold" style="padding-top: 2px; font-size: 16px;">Twitch</label>
          </td>
          <td>
            <input type="text" class="form-control" id="twitchChannel" onchange="onTwitchChannelInput(this.value)" style="height: 26px;">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;"> Ссылка на канал [twitch.tv]</small></td>
        </tr>
      </tbody>
    </table>
  </div>


<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Названия наград</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- tts_reward_clip-->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-camera-video"></i>
          </td>
          <td class="text-end" style="width: 29%;">
            <label for="reward_clip" class="form-label fw-semibold">Для заказа клипов</label>
          </td>
          <td style="width: 30%;">
            <input type="text" class="form-control" id="reward_clip" onchange="reward_clip()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Клип из YouTube добавится в очеред для запуска</small></td>
        </tr>
        <!-- reward_clip_out -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-fast-forward-fill"></i>
          </td>
          <td class="text-end">
            <label for="reward_clip_out" class="form-label fw-semibold">Для заказа клипов вне очереди</label>
          </td>
          <td>
            <input type="text" class="form-control" id="reward_clip_out" onchange="reward_clip_out()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Клип из YouTube добавится вне очереди для запуска</small></td>
        </tr>
        <!-- Озвучка сообщений -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-mic-fill"></i>
          </td>
          <td class="text-end">
            <label for="reward_voice" class="form-label fw-semibold">Для заказа озвучки сообщения</label>
          </td>
          <td>
            <input type="text" class="form-control" id="reward_voice" onchange="reward_voice()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Бот озвучит написанное сообщение в награде</small></td>
        </tr>
        <!--  -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-emoji-laughing-fill"></i>
          </td>
          <td class="text-end">
            <label for="reward_joke" class="form-label fw-semibold">Для заказа aнекдотов</label>
          </td>
          <td>
            <input type="text" class="form-control" id="reward_joke" onchange="reward_joke()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Бот расскажет анекдот (Внимание! Это может быть любой)</small></td>
        </tr>
        <!-- Афоризмы -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-chat-quote-fill"></i>
          </td>
          <td class="text-end">
            <label for="reward_aphorism" class="form-label fw-semibold">Для заказа афоризм</label>
          </td>
          <td>
            <input type="text" class="form-control" id="reward_aphorism" onchange="reward_aphorism()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Бот поделится мудрой цитатой или афоризмом</small></td>
        <!-- Факты -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-journal-text"></i>
          </td>
          <td class="text-end">
            <label for="reward_fact" class="form-label fw-semibold">Для заказа фактов</label>
          </td>
          <td>
            <input type="text" class="form-control" id="reward_fact" onchange="reward_fact()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Бот расскажет интересный факт</small></td>
        </tr>
        <!-- Новости науки -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-globe-americas"></i>
          </td>
          <td class="text-end">
            <label for="reward_science" class="form-label fw-semibold">Для заказа научных новостей</label>
          </td>
          <td>
            <input type="text" class="form-control" id="reward_science" onchange="reward_science()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Бот расскажет название свежей новость из мира науки</small></td>
        </tr>
        <!-- Историческая справка-->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-book"></i>
          </td>
          <td class="text-end">
            <label for="reward_history" class="form-label fw-semibold">Для заказа исторических справок</label>
          </td>
          <td>
            <input type="text" class="form-control" id="reward_history" onchange="reward_history()" title="Точное название для награды">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Бот расскажет что происходило в этот день в разные годы</small></td>
        </tr>

      </tbody>
    </table>
  </div>


<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">OBS WebSocket</h6>



  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- OBS IP -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-hdd-network"></i>
          </td>
          <td class="text-end" style="width: 29%;">
            <label class="form-label fw-semibold" for="obs-host">IP</label>
          </td>
          <td style="width: 30%;">
            <input id="obs-host" type="text" class="form-control" placeholder="127.0.0.1" oninput="autoSaveObsConfig()">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;"> По умолчанию для локальной работы</small></td>
        </tr>
        <!-- OBS Порт -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-plug-fill"></i>
          </td>
          <td class="text-end">
            <label class="form-label fw-semibold" for="obs-port">Порт</label>
          </td>
          <td style="width: 30%;">
            <input id="obs-port" type="text" class="form-control" placeholder="4455" oninput="autoSaveObsConfig()">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;"> По умолчанию для локальной работы</small></td>
        </tr>
        <!-- OBS Пароль -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-shield-lock-fill"></i>
          </td>
          <td class="text-end">
            <label class="form-label fw-semibold" for="obs-password">Пароль</label>
          </td>
          <td style="width: 30%;">
            <input id="obs-password" type="password" class="form-control" placeholder="******" oninput="autoSaveObsConfig()">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">  Для доступа к разделу конструктора "Скрипты"</small></td>
        </tr>
        <!-- Порог потерь кадров -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-exclamation-triangle-fill"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label style="display: inline-block;">
              Порог потери кадров:<span id="dropPercentThresholdLabel" style="display:inline-block; min-width: 9.8em; text-align: right;">5.0</span>%
            </label>
          </td>
          <td style="width: 30%;">
            <input type="range" class="form-control-range" style="display: inline-block;" id="dropPercentThresholdSlider" min="0" max="100" step="0.1" value="2.0" oninput="onDropPercentThresholdSliderChange(this.value)">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Значение, после которого запускать оповещение</small></td>
        </tr>

      </tbody>
    </table>
  </div>



<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Источники в OBS</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- OBS IP -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-box"></i>
          </td>
          <td class="text-end" style="width: 29%;">
            <label for="obs_video" class="form-label fw-semibold">Название источника программы</label>
          </td>
          <td style="width: 30%;">
            <input type="text" class="form-control" id="obs_video" onchange="obs_video()">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">  Для управления громкостью клипа из программы</small></td>
        </tr>
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-box"></i>
          </td>
          <td class="text-end" style="width: 29%;">
            <label for="obs_target" class="form-label fw-semibold">Названия источников для обновления</label>
          </td>
          <td style="width: 30%;">
            <input type="text" class="form-control" id="obs_target" onchange="obs_target()">
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Названия через запятую, что бы вызвать очисту кэш: Alt+B</small></td>
        </tr>
      </tbody>
    </table>
  </div>



<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Стиль интерфейса</h6>
  
  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- collect_viewers -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-people"></i>
          </td>
          <td class="text-end" style="width: 29%;">
            <label for="collect_viewers" class="form-label fw-semibold">Собирать список активных зрителей</label>
          </td>
          <td style="width: 30%;">
              <label class="switchm">
              <input type="checkbox" id="collect_viewers" onchange="onCollectViewersChange()">
              <span class="slider round"></span>
            </label>
          </td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Данные будут в разделе "Отчеты"</small></td>
        </tr>

      </tbody>
    </table>
  </div>


	
	
<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Стиль интерфейса</h6>
	
  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- OBS IP -->
        <tr style="height: 32px;">
          <td style="width: 2%; vertical-align: middle;">
            <i class="bi bi-palette"></i>
          </td>
          <td class="text-end" style="width: 29%; vertical-align: middle;">
            <label class="form-label fw-semibold">Цветовая схема</label>
          </td>
          <td>

      <div class="style-selector">
        <div class="style-box" data-style="1" onclick="selectStyle(1)">        
        </div>
        <div class="style-box" data-style="2" onclick="selectStyle(2)">
        </div>
        <div class="style-box" data-style="3" onclick="selectStyle(3)">
        </div>
        <div class="style-box" data-style="4" onclick="selectStyle(4)">
        </div>
        <div class="style-box" data-style="5" onclick="selectStyle(5)">
        </div>
        <div class="style-box" data-style="6" onclick="selectStyle(6)">
        </div>
        <div class="style-box" data-style="7" onclick="selectStyle(7)">
        </div>
        <div class="style-box" data-style="8" onclick="selectStyle(8)">
        </div>
        <div class="style-box" data-style="9" onclick="selectStyle(9)">
        </div>
        <div class="style-box" data-style="10" onclick="selectStyle(10)">
        </div>
        <div class="style-box" data-style="11" onclick="selectStyle(11)">
        </div>
        <div class="style-box" data-style="12" onclick="selectStyle(12)">
        </div>
        <div class="style-box" data-style="13" onclick="selectStyle(13)">
        </div>
      </div>
          </td>
        </tr>

        <!-- OBS IP -->
        <tr style="height: 32px;">
          <td style="width: 2%; vertical-align: middle;">
            <i class="bi bi-arrows-fullscreen"></i>
          </td>
          <td class="text-end" style="width: 29%; vertical-align: middle;">
            <label for="obs_video" class="form-label fw-semibold">Размер окна программы</label>
          </td>
          <td>
          <div style="bottom: 20px; right: 20px; z-index: 9999;">
            <button class="btn btn-primary btn-16" id="zoomOutBtn" style="font-size: 18px; padding: 2px 46px; margin: 2px 8px 0px 0px;">−</button>
            <button class="btn btn-primary btn-16" id="zoomInBtn" style="font-size: 18px; padding: 2px 45px;">+</button>
          </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
	




</div>



<!-- Чат -->
<div class="tab-pane" id="chat">
  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Настройки OBS чата</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- Ширина -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-fonts"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label style="margin-right: 0px; margin-bottom: 0px;">Шрифт текста сообщений</label>
          </td>
          <td style="width: 32%;">
            <select id="chatFontFamily">
              <option value="sans-serif" style="font-family:sans-serif">Sans-serif</option>
              <option value="monospace" style="font-family:monospace">Monospace</option>
              <option value="serif" style="font-family:serif">Serif</option>
              <option value="cursive" style="font-family:cursive">Cursive</option>
              <option value="MyCustomFont1" style="font-family: 'MyCustomFont1';">Nucleo</option>
              <option value="MyCustomFont2" style="font-family: 'MyCustomFont2';">Tf2</option>
              <option value="MyCustomFont3" style="font-family: 'MyCustomFont3';">Tf2secondary</option>
              <option value="MyCustomFont4" style="font-family: 'MyCustomFont4';">Minecraft</option>
              <option value="MyCustomFont5" style="font-family: 'MyCustomFont5';">Barboskin</option>
              <option value="MyCustomFont6" style="font-family: 'MyCustomFont6';">LT_55933</option>
              <option value="MyCustomFont7" style="font-family: 'MyCustomFont7';">DINNextCYR</option>
              <option value="MyCustomFont8" style="font-family: 'MyCustomFont8';">PF Playskoo</option>
              <option value="MyCustomFont9" style="font-family: 'MyCustomFont9';">TwilightC</option>
              <option value="MyCustomFont10" style="font-family: 'MyCustomFont10';">Verdana</option>
              <option value="MyCustomFont11" style="font-family: 'MyCustomFont11';">TheCrewPro</option>
              <option value="MyCustomFont12" style="font-family: 'MyCustomFont12';">KristenITCCyrillic</option>
              <option value="MyCustomFont13" style="font-family: 'MyCustomFont13';">FoxcroftNF</option>
              <option value="MyCustomFont14" style="font-family: 'MyCustomFont14';">VHS</option>
              <option value="MyCustomFont15" style="font-family: 'MyCustomFont15';">KaaosPro</option>
              <option value="MyCustomFont16" style="font-family: 'MyCustomFont16';">HUNoodles</option>
              <option value="MyCustomFont17" style="font-family: 'MyCustomFont17';">GuardianCircusG</option>
            </select>
          </td>
          <td rowspan="10" style="text-align: center; vertical-align: middle; padding-left: 50px;">
            
              <label for="obsLink" class="col-12 text-end pe-2" style="margin-bottom: 0px;">URL-адрес для OBS [Браузер]:</label>
               <input type="text" class="form-control" id="obsLink" value="http://localhost:8888" readonly onclick="this.select(); document.execCommand('copy')" style="width: 66%; margin-left: 17%; text-align: center;">
               <small class="text-muted d-block mt-1" style="margin-top: 0rem !important;">Нажми для копирования</small>

          </td>
        </tr>

        <!-- Анимация появления сообщений -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-stars"></i>
          </td>
          <td class="text-end">
            <label style="margin-right: 0px; margin-bottom: 0px;">Эффект появления сообщений</label>
          </td>
          <td>
            <select id="chatOverlay">
              <option value="overlay">Появление снизу</option>
              <option value="overlay2">Появление сверху</option>
              <option value="overlay3">Появление слева</option>
              <option value="overlay4">Появление справа</option>
              <option value="overlay5">Увеличение с размытием</option>
              <option value="overlay6">Всплытие (pop-эффект)</option>
              <option value="overlay7">Вращение с появлением</option>
              <option value="overlay8">Подпрыгивание</option>
              <option value="overlay9">Появление с масштабированием</option>
              <option value="overlay10">Появление с наклоном</option>
              <option value="overlay11">Появление с поворотом и сдвигом</option>
              <option value="overlay12">Появление с затуханием и масштабом</option>
              <option value="overlay13">Маска-появление "слева направо", как занавес</option>
              <option value="overlay14">Дрожащий всплеск появления</option>
              <option value="overlay15">Вращение по кругу с зумом</option>
              <option value="overlay16">Появление с искрящимся мерцанием</option>
            </select>
          </td>
        </tr>

        <!-- Анимация появления сообщений -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-clock-fill"></i>
          </td>
          <td class="text-end">
            <label for="chatTimeout" style="margin-right: 0px;">Сколько секунд показывать сообщение</label>
          </td>
          <td>
            <input type="number" class="form-control centry" style=" display: inline-block;" id="chatTimeout" min="1" value="10" onchange="onChatTimeoutChange()">
          </td>
        </tr>
        <!-- Цвет фона сообщений -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-palette-fill"></i>
          </td>
          <td class="text-end">
            <label for="chatBgColor" style="margin-right: 9px;">Цвет фона сообщений</label>
          </td>
          <td>
            <input type="color" id="chatBgColor" value="#fadcA0" oninput="onChatSizeChange()" style="box-shadow: -0.2em -0.25em 0.2em hsl(var(--hue), 8%, 22%) inset, 0.06em 0.04em 0.1em hsla(var(--hue), 8%, 32%), 0.1em 0.14em 0.14em hsl(var(--hue), 10%, 5%) inset, -0.06em -0.06em 0.1em hsla(var(--hue), 10%, 5%); height: 22px; width: 100%;; cursor: pointer;">
          </td>
        </tr>
        <!-- Прозрачность фона-->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-circle-half"></i>
          </td>
          <td class="text-end">
            <label for="chatBgAlpha" style="margin-right: -4px;">Прозрачность фона сообщений</label>
          </td>
          <td>
            <input type="range" id="chatBgAlpha" min="0" max="1" step="0.01" value="0.3" onchange="onChatSizeChange()">
          </td>
        </tr>
        <!-- Цвет текста сообщений -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-palette-fill"></i>
          </td>
          <td class="text-end">
            <label for="chatTextColor" style="margin-right: 9px;">Цвет текста сообщений</label>
          </td>
          <td>
            <input type="color" id="chatTextColor" value="#ffffff" oninput="onChatTextColorChange()" style="box-shadow: -0.2em -0.25em 0.2em hsl(var(--hue), 8%, 22%) inset, 0.06em 0.04em 0.1em hsla(var(--hue), 8%, 32%), 0.1em 0.14em 0.14em hsl(var(--hue), 10%, 5%) inset, -0.06em -0.06em 0.1em hsla(var(--hue), 10%, 5%); height: 22px; width: 100%; cursor: pointer;">
          </td>
        </tr>
        <!-- Цвет текста сообщений -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-palette-fill"></i>
          </td>
          <td class="text-end">
            <label for="chatTextColorName" style="margin-right: 9px;">Цвет текста событий</label>
          </td>
          <td>
            <input type="color" id="chatTextColorName" value="#ffffff" oninput="onChatTextColorNameChange()" style="box-shadow: -0.2em -0.25em 0.2em hsl(var(--hue), 8%, 22%) inset, 0.06em 0.04em 0.1em hsla(var(--hue), 8%, 32%), 0.1em 0.14em 0.14em hsl(var(--hue), 10%, 5%) inset, -0.06em -0.06em 0.1em hsla(var(--hue), 10%, 5%); height: 22px; width: 100%; cursor: pointer;">
          </td>
        </tr>
        <!-- Показывать рамку сообщений -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-border"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="chat_frame" class="form-label fw-semibold">Показывать рамку сообщений</label>
          </td>
          <td style="width: 32%;">
              <label class="switchm">
              <input type="checkbox" id="chat_frame" onchange="onChatFrameChange()">
              <span class="slider round"></span>
              </label>
          </td>
          <td></td>
        </tr>
        <!-- Показывать рамку автора -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-person-bounding-box"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="chat_framen" class="form-label fw-semibold">Показывать рамку авторов сообщений</label>
          </td>
          <td style="width: 32%;">
              <label class="switchm">
              <input type="checkbox" id="chat_framen" onchange="onChatFramenChange()">
              <span class="slider round"></span>
              </label>
          </td>
          <td></td>
        </tr>
        <!-- Отображение времени -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-stopwatch-fill"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="chat_time" class="form-label fw-semibold">Показывать время сообщений</label>
          </td>
          <td style="width: 32%;">
              <label class="switchm">
              <input type="checkbox" id="chat_time" onchange="onChatTimeChange()">
              <span class="slider round"></span>
              </label>
          </td>
          <td></td>
        </tr>

      </tbody>
    </table>
  </div>




 
	<hr class="my-4">
	<h6 class="mb-3" style="text-align: right;">Настройки оверлея чата</h6>
	

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- Высота окна чата-->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrows-angle-expand"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="chatHeightOv" style="margin-right: 30px;">Высота окна чата</label>
          </td>
          <td style="width: 32%;">
            <input type="number" class="form-control centry" style="display: inline-block;" id="chatHeightOv" min="1" value="1000" onchange="onChatSizeChangeOv()">
          </td>
          <td rowspan="5" style="text-align: center; vertical-align: middle;  padding-left: 4.6%;">

    <div class="form-group" style="top: -11px; text-align: center;">
      <!-- <label style="margin-right: 3px;">
      <img src="svg/power_1.svg" style="width: 16px; filter: brightness(0) invert(1); margin-right: 2px;">
      Включить | Выключить:
      </label>  -->
      <label class="switch" style="display: inline-block; top: 17px;">
      <input id="overlayToggle" class="switch__input" type="checkbox" role="switch" onchange="toggleOverlay('overlay', this.checked)" />
      <span class="switch__base-outer"></span>
      <span class="switch__base-inner"></span>
      <svg class="switch__base-neon" viewBox="0 0 40 24" width="40px" height="24px">
        <path fill="none" stroke="url(#switch-gradient1)" stroke-width="1" stroke-dasharray="0 104.26 0"
        stroke-dashoffset="0.01" stroke-linecap="round"
        d="m.5,12C.5,5.649,5.649.5,12,.5h16c6.351,0,11.5,5.149,11.5,11.5s-5.149,11.5-11.5,11.5H12C5.649,23.5.5,18.351.5,12Z" />
      </svg>
      <span class="switch__knob-shadow"></span>
      <span class="switch__knob-container">
        <span class="switch__knob"></span>
      </span>
      <span class="switch__text">TTS</span>
          <svg class="switch__base-neon" viewBox="0 0 40 24" width="40px" height="24px">
            <defs>
              <filter id="switch-glow">
                <feGaussianBlur result="coloredBlur" stddeviation="1"></feGaussianBlur>
                <feMerge>
                  <feMergeNode in="coloredBlur"></feMergeNode>
                  <feMergeNode in="SourceGraphic"></feMergeNode>
                </feMerge>
              </filter>
              <linearGradient id="switch-gradient1" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="hsl(var(--on-hue1),90%,70%)" />
                <stop offset="100%" stop-color="hsl(var(--on-hue2),90%,70%)" />
              </linearGradient>
              <linearGradient id="switch-gradient2" x1="0.7" y1="0" x2="0.3" y2="1">
                <stop offset="25%" stop-color="hsla(var(--on-hue1),90%,70%,0)" />
                <stop offset="50%" stop-color="hsla(var(--on-hue1),90%,70%,0.3)" />
                <stop offset="100%" stop-color="hsla(var(--on-hue2),90%,70%,0.3)" />
              </linearGradient>
            </defs>
            <path fill="none" filter="url(#switch-glow)" stroke="url(#switch-gradient1)" stroke-width="1" stroke-dasharray="0 104.26 0" stroke-dashoffset="0.01" stroke-linecap="round" d="m.5,12C.5,5.649,5.649.5,12,.5h16c6.351,0,11.5,5.149,11.5,11.5s-5.149,11.5-11.5,11.5H12C5.649,23.5.5,18.351.5,12Z"/>
          </svg>
      </label>
    </div>

          </td>
        </tr>
        <!-- Ширина окна чата -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrows-angle-expand"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="chatWidthOv" style="margin-right: 25px;">Ширина окна чата</label>
          </td>
          <td style="width: 30%;">
            <input type="number" class="form-control centry" style="display: inline-block;" id="chatWidthOv" min="1" value="10" onchange="onChatSizeChangeOv()">
          </td>
        </tr>
        <!-- Расположение чата X -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrow-down-up"></i>
          <td class="text-end" style="width: 28%;">
            <label for="chatWidthX" style="margin-right: 3px;">Расположение чата X</label>
          </td>
          <td style="width: 30%;">
            <input type="number" class="form-control centry" style="display: inline-block;" id="chatWidthX" min="1" value="10" onchange="onChatSizeChangeOv()">
          </td>
        </tr>
        <!-- Расположение чата Y -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrow-left-right"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="chatWidthY" style="margin-right: 3px;">Расположение чата Y</label>
          </td>
          <td style="width: 30%;">
            <input type="number" class="form-control centry" style="display: inline-block;" id="chatWidthY" min="1" value="10" onchange="onChatSizeChangeOv()">
          </td>
        </tr>
        <!-- Размер текста чата -->
        <tr>
          <td>
            <i class="bi bi-text-paragraph"></i>
          </td>
          <td>
            <label for="chatZoomOv" style="margin-right: 14px;">Размер текста чата</label>
          </td>
          <td>
            <input type="number" class="form-control centry" style="display: inline-block;" id="chatZoomOv" min="1" value="10" onchange="onChatSizeChangeOv()">
          </td>
        </tr>

      </tbody>
    </table>
  </div>



	
	<hr class="my-4">
	<h6 class="mb-3" style="text-align: right;">Настройки доп. оверлея</h6>
 		
  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- Ссылка на виджет 1 -->
        <tr>
          <td style="width: 2%; text-align: center; vertical-align: middle;" >
            <i class="bi bi-link-45deg"></i>
          </td>
          <td class="text-end" style="vertical-align: middle; width: 30%;">
            <label for="chatOvd" class="form-label fw-semibold">Ссылка на виджет №1</label>
          </td>
          <td style="width: 32%; text-align: center; vertical-align: middle;">
            <input type="text" class="form-control" id="chatOvd" onchange="onChatSizeChangeOv()">
          </td>
          <td rowspan="3" style="text-align: center; vertical-align: middle;  padding-left: 4.7%;">

    <div class="form-group" style="top: -11px; text-align: center;">
      <!-- <label style="margin-right: 3px;">
      <img src="svg/power_1.svg" style="width: 16px; filter: brightness(0) invert(1); margin-right: 2px;">
      Включить | Выключить:
      </label>  -->
      <label class="switch" style="display: inline-block; top: 17px;">
      <input id="overlay2Toggle" class="switch__input" type="checkbox" role="switch"
       onchange="toggleOverlay('overlay2', this.checked); toggleInputs2(this.checked)">
      <span class="switch__base-outer"></span>
      <span class="switch__base-inner"></span>
      <svg class="switch__base-neon" viewBox="0 0 40 24" width="40px" height="24px">
        <path fill="none" stroke="url(#switch-gradient1)" stroke-width="1" stroke-dasharray="0 104.26 0"
        stroke-dashoffset="0.01" stroke-linecap="round"
        d="m.5,12C.5,5.649,5.649.5,12,.5h16c6.351,0,11.5,5.149,11.5,11.5s-5.149,11.5-11.5,11.5H12C5.649,23.5.5,18.351.5,12Z" />
      </svg>
      <span class="switch__knob-shadow"></span>
      <span class="switch__knob-container">
        <span class="switch__knob"></span>
      </span>
      <span class="switch__text">TTS</span>
      </label>
    </div>

          </td>
        </tr>
        <!-- Ссылка на виджет 1 -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrows-angle-expand"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="window1_width" class="form-label fw-semibold">Высота окна виджета №1</label>
          </td>
          <td style="width: 32%;">
            <input type="number" class="form-control" id="window1_width" onchange="window1_width()">
          </td>
        </tr>
        <!-- Ссылка на виджет 1 -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrows-angle-expand"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="window1_height" class="form-label fw-semibold">Ширина окна виджета №1</label>
          </td>
          <td style="width: 32%;">
            <input type="number" class="form-control" id="window1_height" onchange="window1_height()">
          </td>
        </tr>

      </tbody>
    </table>
  </div>



  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- Ссылка на виджет 1 -->
        <tr>
          <td style="width: 2%; text-align: center; vertical-align: middle;" >
            <i class="bi bi-link-45deg"></i>
          </td>
          <td class="text-end" style="vertical-align: middle; width: 30%;">
            <label for="chatOvd" class="form-label fw-semibold">Ссылка на виджет №2</label>
          </td>
          <td style="width: 32%; text-align: center; vertical-align: middle;">
            <input type="text" class="form-control" id="chatOvd2" onchange="onChatSizeChangeOv2()">
          </td>
          <td rowspan="3" style="text-align: center; vertical-align: middle;  padding-left: 4.7%;">

    <div class="form-group" style="top: -11px; text-align: center;">
      <!-- <label style="margin-right: 3px;">
      <img src="svg/power_1.svg" style="width: 16px; filter: brightness(0) invert(1); margin-right: 2px;">
      Включить | Выключить:
      </label>  -->
      <label class="switch" style="display: inline-block; top: 17px;">
      <input id="overlay3Toggle" class="switch__input" type="checkbox" role="switch"
       onchange="toggleOverlay('overlay3', this.checked); toggleInputs3(this.checked)">
      <span class="switch__base-outer"></span>
      <span class="switch__base-inner"></span>
      <svg class="switch__base-neon" viewBox="0 0 40 24" width="40px" height="24px">
        <path fill="none" stroke="url(#switch-gradient1)" stroke-width="1" stroke-dasharray="0 104.26 0"
        stroke-dashoffset="0.01" stroke-linecap="round"
        d="m.5,12C.5,5.649,5.649.5,12,.5h16c6.351,0,11.5,5.149,11.5,11.5s-5.149,11.5-11.5,11.5H12C5.649,23.5.5,18.351.5,12Z" />
      </svg>
      <span class="switch__knob-shadow"></span>
      <span class="switch__knob-container">
        <span class="switch__knob"></span>
      </span>
      <span class="switch__text">TTS</span>
      </label>
    </div>

          </td>
        </tr>
        <!-- Ссылка на виджет 1 -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrows-angle-expand"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="window2_width" class="form-label fw-semibold">Высота окна виджета №2</label>
          </td>
          <td style="width: 32%;">
            <input type="number" class="form-control" id="window2_width" onchange="window2_width()">
          </td>
        </tr>
        <!-- Ссылка на виджет 1 -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-arrows-angle-expand"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="window2_height" class="form-label fw-semibold">Ширина окна виджета №2</label>
          </td>
          <td style="width: 32%;">
            <input type="number" class="form-control" id="window2_height" onchange="window2_height()">
          </td>
        </tr>

      </tbody>
    </table>
  </div>

</div>


<!-- Озвучка -->
<div class="tab-pane" id="voice">

<!-- >Настройки озвучки -->
  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Настройки голоса</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- Голос озвучки -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-mic-fill"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="voiceSelect">Голос озвучки:</label>
          </td>
          <td style="width: 32%;">
            <select id="voiceSelect" onchange="onVoiceChange(this.value)" style=" outline: none;">
              <option value="ru-RU-SvetlanaNeural">Светик</option>
              <option value="ru-RU-DmitryNeural">Серый</option>
            </select>
          </td>
          <td rowspan="4" style="text-align: center; vertical-align: middle;  padding-left: 3.4%;">

    <div class="form-group" style="top: -11px; text-align: center;">
      <!--<label style="margin-right: 22px;">
      <img src="svg/power_1.svg" style="width: 16px; filter: brightness(0) invert(1); margin-right: 2px;">
      Озвучка сообщений:
      </label>-->
      <label class="switch" style="display: inline-block; top: 17px;">
      <input id="ttsToggleSwitch" class="switch__input" type="checkbox" role="switch" onchange="onTtsToggle(this.checked)" />
      <span class="switch__base-outer"></span>
      <span class="switch__base-inner"></span>
      <svg class="switch__base-neon" viewBox="0 0 40 24" width="40px" height="24px">
        <path fill="none" stroke="url(#switch-gradient10)" stroke-width="1" stroke-dasharray="0 104.26 0"
        stroke-dashoffset="0.01" stroke-linecap="round"
        d="m.5,12C.5,5.649,5.649.5,12,.5h16c6.351,0,11.5,5.149,11.5,11.5s-5.149,11.5-11.5,11.5H12C5.649,23.5.5,18.351.5,12Z" />
      </svg>
          <svg class="switch__base-neon" viewBox="0 0 40 24" width="40px" height="24px">
            <defs>
              <filter id="switch-glow">
                <feGaussianBlur result="coloredBlur" stddeviation="1"></feGaussianBlur>
                <feMerge>
                  <feMergeNode in="coloredBlur"></feMergeNode>
                  <feMergeNode in="SourceGraphic"></feMergeNode>
                </feMerge>
              </filter>
              <linearGradient id="switch-gradient10" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="hsl(var(--on-hue1),90%,70%)" />
                <stop offset="100%" stop-color="hsl(var(--on-hue2),90%,70%)" />
              </linearGradient>
              <linearGradient id="switch-gradient20" x1="0.7" y1="0" x2="0.3" y2="1">
                <stop offset="25%" stop-color="hsla(var(--on-hue1),90%,70%,0)" />
                <stop offset="50%" stop-color="hsla(var(--on-hue1),90%,70%,0.3)" />
                <stop offset="100%" stop-color="hsla(var(--on-hue2),90%,70%,0.3)" />
              </linearGradient>
            </defs>
            <path fill="none" filter="url(#switch-glow)" stroke="url(#switch-gradient10)" stroke-width="1" stroke-dasharray="0 104.26 0" stroke-dashoffset="0.01" stroke-linecap="round" d="m.5,12C.5,5.649,5.649.5,12,.5h16c6.351,0,11.5,5.149,11.5,11.5s-5.149,11.5-11.5,11.5H12C5.649,23.5.5,18.351.5,12Z"/>
          </svg>
      <span class="switch__knob-shadow"></span>
      <span class="switch__knob-container">
        <span class="switch__knob"></span>
      </span>
      <span class="switch__text">TTS</span>
      </label>
    </div>

          </td>
        </tr>
        <!-- Громкость озвучки -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-volume-up-fill"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label style="display: inline-block;">
            Громкость озвучки:<span id="ttsVolumeLabel" style="display:inline-block; min-width: 11.3em; text-align: right;">80</span>%
            </label>
          </td>
          <td style="width: 30%;">
            <input type="range" class="form-control-range" style="display: inline-block;" id="ttsVolumeSlider" min="0" max="100" value="80" oninput="onTtsVolumeSliderChange(this.value)">
          </td>
        </tr>
        <!-- Скорость озвучки -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-speedometer2"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label>
            Скорость озвучки:<span id="ttsRateLabel" style="display:inline-block; min-width: 11.8em; text-align: right;">20</span>%
            </label>
          </td>
          <td style="width: 30%;">
            <input type="range" id="ttsRateSlider" min="0" max="100" step="1" value="12" style="vertical-align: top;">
          </td>
        </tr>
        <!-- Тест озвучки -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-play-circle-fill"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label style="display: inline-block; margin-right: -4px;">
            Тест озвучки:
            </label>
          </td>
          <td style="width: 30%;">
            <button class="btn-primary" onclick="testTts()" title="Тест озвучки сообщений" style="width: 100%; border-radius: 50px; outline: none;"><img src="svg/speaker_2.svg" style="width: 22px; margin-right: 3px;"></button>
          </td>
        </tr>

      </tbody>
    </table>
  </div>


    <!-- Модальное окно -->
<div id="modalAuthors" class="modal-bg" style="display:none;">
  <div class="modal" style="max-width: 800px;">
    <h2>Имена для замены озвучки</h2>
    <div id="authorsScroll" style="max-height: 416px; overflow-y: auto;">
      <table id="authorsTable" border="1" cellspacing="0" cellpadding="6" style="width:100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th style="color: var(--primary-color); width: 42%; position: sticky; top: 0; background: #212121; z-index: 1;">Имя</th>
            <th style="color: var(--primary-color); width: 42%; position: sticky; top: 0; background: #212121; z-index: 1;">Как озвучивать</th>
            <th style="color: var(--primary-color); position: sticky; top: 0; background: #212121; z-index: 1;">Действия</th>
          </tr>
        </thead>
        <tbody id="authorsTableBody">
          <!-- строки динамически заполняются -->
        </tbody>
      </table>
    </div>
    <div style="margin-top: 24px; text-align: right;">
      <button onclick="openAddAuthorModal()" class="btn btn-primary">➕ Добавить имя</button>
      <button onclick="closeAuthorsModal()" class="btn btn-secondary">Закрыть</button>
    </div>
  </div>
</div>
<!-- Модальное окно подтверждения удаления действия -->
<div id="deleteAuthorModal" class="modal-bg" style="display: none;">
  <div class="modal" style="max-width: 400px;">
    <h2 style="margin-bottom: 16px;">Удалить имя</h2>
    <p id="deleteAuthorDescription">Вы действительно хотите удалить это имя?</p>
    <div style="margin-top: 24px; text-align: right;">
      <button onclick="confirmDeleteAuthorNow()" class="btn btn-danger">Удалить</button>
      <button onclick="closeDeleteAuthorModal()" class="btn btn-secondary">Отмена</button>
    </div>
  </div>
</div>


    <!-- Тот самый твой модал для добавления/редактирования -->
    <div id="authorTtsModal" class="modal-bg" style="display:none;">
      <div class="modal" style="max-width: 500px;">
        <h2 id="authorModalTitle">Добавить</h2>
        <input type="text" id="authorNameInput" placeholder="Имя автора" style="width: 100%; margin: 4px; padding: 4px;" />
        <input type="text" id="speakAsInput" placeholder="Как озвучивать" style="width: 100%; margin: 4px; padding: 4px;" />
        <div style="text-align: right; padding-top: 20px;">
          <button onclick="saveAuthor()" class="btn btn-primary" style="width: 30%;">💾 Сохранить</button>
          <button onclick="closeAuthorModal()" class="btn btn-secondary">✖ Закрыть</button>
        </div>
      </div>
    </div>


<!-- >Настройки фраз -->
  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Настройки фраз</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- tts_text -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-chat-left-dots-fill"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="tts_text" class="form-label fw-semibold">Озвучка перед сообщением:</label>
          </td>
          <td style="width: 32%;">
            <input type="text" class="form-control" id="tts_text" onchange="tts_text()">
          </td>
          <td></td>
        </tr>
        <!-- tts_scream -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-chat-left-dots-fill"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="tts_scream" class="form-label fw-semibold">Озвучка перед сообщением капсом:</label>
          </td>
          <td style="width: 32%;">
            <input type="text" class="form-control" id="tts_scream" onchange="tts_scream()">
          </td>
          <td></td>
        </tr>
        <!-- site_text -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-chat-left-dots-fill"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="site_text" class="form-label fw-semibold">Озвучка ссылки:</label>
          </td>
          <td style="width: 30%;">
            <input type="text" class="form-control" id="site_text" onchange="site_text()">
          </td>
          <td></td>
        </tr>
        <!-- welcome_portal -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-chat-left-dots-fill"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="welcome_portal" class="form-label fw-semibold">Приветствие пришедших из портала:</label>
          </td>
          <td style="width: 30%;">
            <input type="text" class="form-control" id="welcome_portal" onchange="welcome_portal()">
          </td>
          <td></td>
        </tr>
        <!-- tts_text -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-chat-left-dots-fill"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="tts_text_raid" class="form-label fw-semibold">Озвучка рейда:</label>
          </td>
          <td style="width: 32%;">
            <input type="text" class="form-control" id="tts_text_raid" onchange="tts_text_raid()">
          </td>
          <td></td>
        </tr>

      </tbody>
    </table>
  </div>

<!-- >Настройки фраз -->
  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Настройки озвучки</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- stat_sender -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-person-lines-fill"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="stat_sender" class="form-label fw-semibold">Озвучка имени отправителя:</label>
          </td>
          <td style="width: 32%;">
              <label class="switchm">
              <input type="checkbox" id="stat_sender" onchange="onStatSenderChange()">
              <span class="slider round"></span>
              </label>
          </td>
          <td></td>
        </tr>
        <!-- skip_repeated_sender -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-person-lines-fill"></i>
          </td>
          <td class="text-end" style="width: 30%;">
            <label for="skip_repeated_sender" class="form-label fw-semibold">Озвучка имени отправителя повторно:</label>
          </td>
          <td style="width: 32%;">
              <label class="switchm">
              <input type="checkbox" id="skip_repeated_sender" onchange="onSkipRepeatedSenderChange()">
              <span class="slider round"></span>
              </label>
          </td>
          <td></td>
        </tr>
        <!-- tts_clip -->
        <tr>
          <td style="width: 2%;">
            <i class="bi bi-film"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="tts_clip" class="form-label fw-semibold">Озвучка заказанных клипов:</label>
          </td>
          <td style="width: 30%;">
              <label class="switchm">
              <input type="checkbox" id="tts_clip" onchange="onTtsClipChange()">
              <span class="slider round"></span>
              </label>
          </td>
          <td></td>
        </tr>

      </tbody>
    </table>
  </div>


<!-- Замена имени -->
  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Управление именами</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- Тест озвучки -->
        <tr>
          <td rowspan="2" style="width: 2%; vertical-align: middle;">
            <i class="bi bi-person-badge"></i>
          </td>
          <td rowspan="2" class="text-end" style="width: 30%; vertical-align: middle;">
            <label style="display: inline-block; margin-right: -4px;">
            Замена имени:
            </label>
          </td>
          <td style="width: 32%;">
            <div id="author-tts-list"></div>
              <button style="width: 100%;" onclick="openAuthorsModal()" class="btn btn-primary">✏️ Список для замены</button>
          </td><td></td>
        </tr>

      </tbody>
    </table>
  </div>


<!-- Спам фильтр -->
  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Фильтр спама</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>
        <!-- Тест озвучки -->
        <tr>
          <td style="width: 2%;"><i class="bi bi-arrow-repeat"></i></td>
          <td class="text-end" style="width: 28%; vertical-align: middle;"><label for="char_repeat_threshold" class="form-label fw-semibold">Повтор символа</label></td>
          <td style="width: 2%;"><span style="display:inline-block; text-align: right;"><b>></b></span></td>
          <td style="width: 32%; vertical-align: middle;"><input type="number" class="form-control" id="char_repeat_threshold" placeholder="По умолчанию: 3" onchange="updateSpamThresholds()" ></td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Например: аааа</small></td>
        </tr>
        <tr>
          <td><i class="bi bi-text-paragraph"></i></td>
          <td class="text-end"><label for="word_repeat_sequence_length" class="form-label fw-semibold">Повтор слов</label></td>
          <td style="width: 2%;"><span style="display:inline-block; text-align: right;"><b>></b></span></td>
          <td><input type="number" class="form-control" id="word_repeat_sequence_length" placeholder="По умолчанию: 4" onchange="updateSpamThresholds()"></td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Слово повторяется несколько раз подряд</small></td>
        </tr>

        <tr>
          <td><i class="bi bi-journals"></i></td>
          <td class="text-end"><label for="phrase_repeat_threshold" class="form-label fw-semibold">Повтор фраз</label></td>
          <td style="width: 2%;"><span style="display:inline-block; text-align: right;"><b>></b></span></td>
          <td><input type="number" class="form-control" id="phrase_repeat_threshold" placeholder="По умолчанию: 3" onchange="updateSpamThresholds()"></td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Фразы повторяются: "Привет как дела Привет как дела"</small></td>
        </tr>

        <tr>
          <td><i class="bi bi-exclamation-diamond"></i></td>
          <td class="text-end"><label for="special_char_repeat_threshold" class="form-label fw-semibold">Повтор спецсимволов</label></td>
          <td style="width: 2%;"><span style="display:inline-block; text-align: right;"><b>></b></span></td>
          <td><input type="number" class="form-control" id="special_char_repeat_threshold" placeholder="По умолчанию: 4" onchange="updateSpamThresholds()"></td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Например: !!!!! или ####</small></td>
        </tr>

        <tr>
          <td><i class="bi bi-emoji-expressionless-fill"></i></td>
          <td class="text-end"><label for="emoji_repeat_threshold" class="form-label fw-semibold">Повтор эмодзи</label></td>
          <td style="width: 2%;"><span style="display:inline-block; text-align: right;"><b>></b></span></td>
          <td><input type="number" class="form-control" id="emoji_repeat_threshold" placeholder="По умолчанию: 4" onchange="updateSpamThresholds()"></td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Сколько раз подряд один и тот же эмодзи</small></td>
        </tr>

        <tr>
          <td><i class="bi bi-emoji-smile-fill"></i></td>
          <td class="text-end"><label for="max_emojis_total" class="form-label fw-semibold">Эмодзи всего</label></td>
          <td style="width: 2%;"><span style="display:inline-block; text-align: right;"><b>></b></span></td>
          <td><input type="number" class="form-control" id="max_emojis_total" placeholder="По умолчанию: 4" onchange="updateSpamThresholds()"></td>
          <td><small style="padding-left: 30px; color: #6d6d6d;">Максимальное число эмодзи в сообщении</small></td>
        </tr>

      </tbody>
    </table>
  </div>


</div>


<div id="scriptModal" class="modal-bg" style="display:none;">
  <div class="modal" style="max-width: 80%; min-height: 84%; margin-top: 8%; padding: 14px;">
    <span style="font-size: 38px; margin-top: -6px;" class="close" onclick="closeModal()">&times;</span>
    <div id="modalContent"></div>
  </div>
</div>

<!-- Модальное окно подтверждения удаления действия -->
<div id="deleteActionModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;">
  <div class="modal" style="min-width: 40%; padding: 20px;">
    <h3 id="deleteActionModal">Вы уверены, что хотите удалить это действие?</h3>
    <div style="text-align: right; margin-top: 16px;">
      <button id="confirmDeleteActionBtn" class="btn btn-danger">Удалить</button>
      <button id="cancelDeleteActionBtn" class="btn btn-secondary">Отмена</button>
    </div>
  </div>
</div>

<div id="confirmDeleteModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;">
  <div class="modal" style="min-width: 40%; padding: 20px;">
    <h3 id="confirmDeleteTitle">Вы действительно хотите удалить скрипт?</h3>
    <div style="text-align: right; margin-top: 16px;">
      <button class="btn btn-danger" onclick="confirmDelete()">Да</button>
      <button class="btn btn-secondary" onclick="closeConfirmDeleteModal()">Нет</button>
    </div>
  </div>
</div>

<!-- Скрипты -->
<div class="tab-pane" id="script">


<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Список скриптов наград</h6>
<div class="card card-chart" style="padding: 6px 10px 6px 10px;">
  <div id="rewardScripts" style="max-height: 710px; height: 710px; overflow-y: auto;"></div>
</div>
<button class="btn btn-primary btn-round custom-btn btn-16" style="width: 100%; margin-top: 10px;" onclick="openCreateRewardModal()">➕ Создать скрипт награды</button>

<!-- Модалка: Создание награды -->
<div id="createRewardModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 999;">
  <div class="modal" style="min-width: 60%;">
    <h2 style="margin-top: 0;">Создать новую награду</h2>
    <table style="width: 100%; border-spacing: 8px;">
      <tr>
        <td style="width: 30%;"><label for="reward_script_name"><strong>Название скрипта:</strong></label></td>
        <td><input id="reward_script_name" placeholder="Имя скрипта" style="margin: 0px 0px 8px 0px; padding: 6px;"></td>
      </tr>
      <tr>
        <td><label for="reward_name"><strong>Название награды:</strong></label></td>
        <td><input id="reward_name" placeholder="Точное имя награды" style="margin: 0px 0px 8px 0px; padding: 6px;"></td>
      </tr>
    </table>
    <div style="text-align: right; margin-top: 16px;">
      <button class="btn btn-primary" onclick="submitCreateReward()">Создать</button>
      <button class="btn btn-secondary" onclick="closeCreateRewardModal()">Отмена</button>
    </div>
  </div>
</div>

</div>


<div id="modalObs" class="modal-bg">
  <div class="modal">
    <h2 style="color: red;">⚠ OBS не подключён</h2>
    <p>Запустите OBS или проверьте настройки подключения к OBS WebSocket</p>
    <div class="buttons">
      <button id="closeObsModal" class="btn btn-primary">Ок</button>
    </div>
  </div>
</div>





<!-- Скрипты -->
<div class="tab-pane" id="alerts">

  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Twitch оповещения</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>

        <tr>
          <td rowspan="2" style="width: 2%; vertical-align: middle;">
            <i class="bi bi-bell"></i>
          </td>
          <td rowspan="2" class="text-end" style="width: 27%; vertical-align: middle;">
            <label style="display: inline-block; margin-right: -4px;">
              Twitch - Панель настройки оповещений
            </label>
          </td>
          <td style="width: 5%;"> </td>
          <td style="width: 32%;">
            <a href="#" id="alerts-link" class="btn btn-primary" style="width: 100%;" onclick="openAlerts(event)">
              🔔 Панель настройки оповещений
            </a>
          </td>
          <td></td>
        </tr>


      </tbody>
    </table>
  </div>

  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">VK Видео Live оповещения</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>

<!-- 🔔 Отслеживает канал -->
<tr>
  <td rowspan="2" style="vertical-align: middle; width: 2%;"><i class="bi bi-person-plus"></i></td>
  <td class="text-end" style="width: 27%;"><label class="form-label fw-semibold">Звук отслеживания канала</label></td>
  <td style="width: 5%; vertical-align: middle;">
    <label class="switchm ms-2" title="Вкл/выкл звук">
      <input type="checkbox" id="sub-audio-toggle" onchange="onSubAudioToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td style="width: 32%;">
    <input type="file" id="sub-audio-file" accept=".mp3" style="display: none;" onchange="uploadSubAudio(this)">
    <button onclick="document.getElementById('sub-audio-file').click()" class="btn btn-primary" style="width: 100%; height: 25px; padding: 0;">🔊 Выбрать Аудио</button>
  </td>
  <td><small style="padding-left: 30px; color: #6d6d6d;"><span id="sub-audio-filename" class="text-muted">Файл не выбран</span></small></td>
</tr>

<tr>
  <td class="text-end"><label class="form-label">Озвучка события</label></td>
  <td>
    <label class="switchm ms-2" title="Озвучивать или нет">
      <input type="checkbox" id="sub-tts-toggle" onchange="onSubTtsToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td colspan="1">
    <input type="text" class="form-control form-control-sm" id="sub-tts-text" placeholder="Текст для озвучки" oninput="onSubTtsTextChange()" />
  </td>
  <td></td>
</tr>




<!-- 🎉 Оформил подписку -->
<tr>
  <td rowspan="2" style="vertical-align: middle; width: 2%;"><i class="bi bi-star-fill"></i></td>
  <td class="text-end"><label class="form-label fw-semibold">Звук оформления подписки</label></td>
  <td>
    <label class="switchm ms-2" title="Вкл/выкл звук">
      <input type="checkbox" id="effect-sub-audio-toggle" onchange="onEffectSubAudioToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td>
    <input type="file" id="effect-sub-audio-file" accept=".mp3" style="display: none;" onchange="uploadEffectSubAudio(this)">
    <button onclick="document.getElementById('effect-sub-audio-file').click()" class="btn btn-primary" style="width: 100%; height: 25px; padding: 0;">🔊 Выбрать Аудио</button>
  </td>
  <td><small style="padding-left: 30px; color: #6d6d6d;"><span id="effect-sub-audio-filename" class="text-muted">Файл не выбран</span></small></td>
</tr>

<tr>
  <td class="text-end"><label class="form-label">Озвучка события</label></td>
  <td>
    <label class="switchm ms-2">
      <input type="checkbox" id="effect-sub-tts-toggle" onchange="onEffectSubTtsToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td colspan="1">
    <input type="text" class="form-control form-control-sm" id="effect-sub-tts-text" placeholder="Текст для озвучки" oninput="onEffectSubTtsTextChange()" />
  </td>
  <td></td>
</tr>


<!-- 🌀 Пришёл из портала -->
<tr>
  <td rowspan="2" style="vertical-align: middle; width: 2%;"><i class="bi bi-box-arrow-in-right"></i></td>
  <td class="text-end"><label class="form-label fw-semibold">Звук из портала</label></td>
  <td>
    <label class="switchm ms-2" title="Вкл/выкл звук">
      <input type="checkbox" id="portal-audio-toggle" onchange="onPortalAudioToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td>
    <input type="file" id="portal-audio-file" accept=".mp3" style="display: none;" onchange="uploadPortalAudio(this)">
    <button onclick="document.getElementById('portal-audio-file').click()" class="btn btn-primary" style="width: 100%; height: 25px; padding: 0;">🔊 Выбрать Аудио</button>
  </td>
  <td><small style="padding-left: 30px; color: #6d6d6d;"><span id="portal-audio-filename" class="text-muted">Файл не выбран</span></small></td>
</tr>

<tr>
  <td class="text-end"><label class="form-label">Озвучка события</label></td>
  <td>
    <label class="switchm ms-2">
      <input type="checkbox" id="portal-tts-toggle" onchange="onPortalTtsToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td colspan="1">
    <input type="text" class="form-control form-control-sm" id="portal-tts-text" placeholder="Текст для озвучки" oninput="onPortalTtsTextChange()" />
  </td>
  <td></td>
</tr>


<!-- ⚔️ Начинает рейд -->
<tr>
  <td rowspan="2" style="vertical-align: middle; width: 2%;"><i class="bi bi-fire"></i></td>
  <td class="text-end"><label class="form-label fw-semibold">Звук начала рейда</label></td>
  <td>
    <label class="switchm ms-2" title="Вкл/выкл звук">
      <input type="checkbox" id="raid-audio-toggle" onchange="onRaidAudioToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td>
    <input type="file" id="raid-audio-file" accept=".mp3" style="display: none;" onchange="uploadRaidAudio(this)">
    <button onclick="document.getElementById('raid-audio-file').click()" class="btn btn-primary" style="width: 100%; height: 25px; padding: 0;">🔊 Выбрать Аудио</button>
  </td>
  <td><small style="padding-left: 30px; color: #6d6d6d;"><span id="raid-audio-filename" class="text-muted">Файл не выбран</span></small></td>
</tr>

<tr>
  <td class="text-end"><label class="form-label">Озвучка события</label></td>
  <td>
    <label class="switchm ms-2">
      <input type="checkbox" id="raid-tts-toggle" onchange="onRaidTtsToggleChange()">
      <span class="slider round"></span>
    </label>
  </td>
  <td colspan="1">
    <input type="text" class="form-control form-control-sm" id="raid-tts-text" placeholder="Текст для озвучки" oninput="onRaidTtsTextChange()" />
  </td>
  <td></td>
</tr>



<script>

function updateAllSettings(settings) {
    try {
        if (settings.vk_channel) document.getElementById('vk-channel').value = settings.vk_channel;
        if (settings.twitch_channel) document.getElementById('twitch-channel').value = settings.twitch_channel;
        if (settings.volume) document.getElementById('volume').value = settings.volume;
        if (settings.zoom_level) document.body.style.zoom = settings.zoom_level;
        if (settings.overlay_enabled) document.getElementById('overlay-toggle').checked = settings.overlay_enabled;
        console.log('UI обновлён:', settings);
    } catch (e) {
        console.error('Ошибка обновления UI:', e);
    }
}



function copyEventUserFilePath() {
  const input = document.getElementById("event-user-file-path");
  navigator.clipboard.writeText(input.value)
    .then(() => {
      input.classList.add("border-success");
      setTimeout(() => input.classList.remove("border-success"), 1000);
    })
    .catch(err => {
      console.error("Не удалось скопировать путь:", err);
    });
}


document.addEventListener("DOMContentLoaded", function () {
  const path = window.location.origin + "/interface/event_user_display.html";
  document.getElementById("event-user-file-path").value = path;
});



// ======= TTS: SUB =======
function onSubTtsToggleChange() {
  pywebview.api.setSubTtsEnabled(document.getElementById("sub-tts-toggle").checked);
}
function onSubTtsTextChange() {
  pywebview.api.setSubTtsText(document.getElementById("sub-tts-text").value);
}
function updateSubTtsSettings(enabled, text) {
  document.getElementById("sub-tts-toggle").checked = !!enabled;
  document.getElementById("sub-tts-text").value = text || "";
}

// ======= TTS: EFFECT SUB =======
function onEffectSubTtsToggleChange() {
  pywebview.api.setEffectSubTtsEnabled(document.getElementById("effect-sub-tts-toggle").checked);
}
function onEffectSubTtsTextChange() {
  pywebview.api.setEffectSubTtsText(document.getElementById("effect-sub-tts-text").value);
}
function updateEffectSubTtsSettings(enabled, text) {
  document.getElementById("effect-sub-tts-toggle").checked = !!enabled;
  document.getElementById("effect-sub-tts-text").value = text || "";
}

// ======= TTS: PORTAL =======
function onPortalTtsToggleChange() {
  pywebview.api.setPortalTtsEnabled(document.getElementById("portal-tts-toggle").checked);
}
function onPortalTtsTextChange() {
  pywebview.api.setPortalTtsText(document.getElementById("portal-tts-text").value);
}
function updatePortalTtsSettings(enabled, text) {
  document.getElementById("portal-tts-toggle").checked = !!enabled;
  document.getElementById("portal-tts-text").value = text || "";
}

// ======= TTS: RAID =======
function onRaidTtsToggleChange() {
  pywebview.api.setRaidTtsEnabled(document.getElementById("raid-tts-toggle").checked);
}
function onRaidTtsTextChange() {
  pywebview.api.setRaidTtsText(document.getElementById("raid-tts-text").value);
}
function updateRaidTtsSettings(enabled, text) {
  document.getElementById("raid-tts-toggle").checked = !!enabled;
  document.getElementById("raid-tts-text").value = text || "";
}



  function uploadAudioGeneric(input, apiSetMethod, fileSpanId) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function (e) {
      const base64Data = e.target.result.split(',')[1];
      pywebview.api.save_sub_audio(file.name, base64Data).then(() => {
        pywebview.api[apiSetMethod](file.name).then(() => {
          document.getElementById(fileSpanId).innerText = file.name;
        });
      });
    };
    reader.readAsDataURL(file);
  }

  // ======= Отслеживает канал =======
  function onSubAudioToggleChange() {
    pywebview.api.setSubscriptionSoundEnabled(document.getElementById("sub-audio-toggle").checked);
  }
  function uploadSubAudio(input) {
    uploadAudioGeneric(input, "setSubscriptionSound", "sub-audio-filename");
  }
  function updateSubscriptionSound(fileName, enabled) {
    document.getElementById("sub-audio-filename").innerText = fileName || "Файл не выбран";
    document.getElementById("sub-audio-toggle").checked = !!enabled;
  }

  // ======= Оформил подписку =======
  function onEffectSubAudioToggleChange() {
    pywebview.api.setEffectSubscriptionEnabled(document.getElementById("effect-sub-audio-toggle").checked);
  }
  function uploadEffectSubAudio(input) {
    uploadAudioGeneric(input, "setEffectSubscriptionSound", "effect-sub-audio-filename");
  }
  function updateEffectSubscriptionSound(fileName, enabled) {
    document.getElementById("effect-sub-audio-filename").innerText = fileName || "Файл не выбран";
    document.getElementById("effect-sub-audio-toggle").checked = !!enabled;
  }

  // ======= Из портала =======
  function onPortalAudioToggleChange() {
    pywebview.api.setPortalEnabled(document.getElementById("portal-audio-toggle").checked);
  }
  function uploadPortalAudio(input) {
    uploadAudioGeneric(input, "setPortalSound", "portal-audio-filename");
  }
  function updatePortalSound(fileName, enabled) {
    document.getElementById("portal-audio-filename").innerText = fileName || "Файл не выбран";
    document.getElementById("portal-audio-toggle").checked = !!enabled;
  }

  // ======= Рейд =======
  function onRaidAudioToggleChange() {
    pywebview.api.setRaidEnabled(document.getElementById("raid-audio-toggle").checked);
  }
  function uploadRaidAudio(input) {
    uploadAudioGeneric(input, "setRaidSound", "raid-audio-filename");
  }
  function updateRaidSound(fileName, enabled) {
    document.getElementById("raid-audio-filename").innerText = fileName || "Файл не выбран";
    document.getElementById("raid-audio-toggle").checked = !!enabled;
  }


let lastKnownUser = null;
async function updateLastUser() {
  try {
    const lastUser = await window.pywebview.api.get_last_event_user();
    if (lastUser !== lastKnownUser) {
      console.log("Ник обновился:", lastUser);
      document.getElementById("last-event-user").textContent = lastUser || "-";
      lastKnownUser = lastUser;
    } else {
      console.log("Ник не изменился");
    }
  } catch(e) {
    console.error("Ошибка при получении ника:", e);
  }
}
document.addEventListener('DOMContentLoaded', () => {
  updateLastUser();
  setInterval(updateLastUser, 6000);
});




</script>


      </tbody>
    </table>



<hr class="my-4">
  <div style="padding: 0px 6px 0px 6px;">
  <div id="eventScripts" style="max-height: 212px; background: #252525; margin: 5px; overflow-y: auto; box-shadow: -0.25em -0.25em 0.25em hsl(223deg 3.65% 18.13%) inset, 0.0625em 0.0625em 0.875px 0.125em hsl(0deg 0% 6.72%), 0.125em 0.25em 0.25em hsl(var(--hue), 10%, 5%) inset, -0.0625em -0.0625em 0.125em hsla(var(--hue), 10%, 5%);"></div>
</div>

<button class="btn btn-primary btn-round custom-btn btn-16" style="width: 100%; margin-top: 10px;" onclick="openCreateEventModal()">➕ Создать скрипт события</button>


<!-- Модалка: Создание события -->
<div id="createEventModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 999;">
  <div class="modal" style="min-width: 60%;">
    <h2 style="margin-top: 0;">Создать новое событие</h2>
    <table style="width: 100%; border-spacing: 8px;">
      <tr>
        <td style="width: 30%;"><label for="event_script_name"><strong>Название скрипта:</strong></label></td>
        <td><input id="event_script_name" placeholder="Имя скрипта" style="margin: 0px 0px 8px 0px; padding: 6px;"></td>
      </tr>
      <tr>
        <td><label for="event_name"><strong>Название события:</strong></label></td>
        <td><input id="event_name" placeholder="Например: теперь отслеживает канал" style="margin: 0px 0px 8px 0px; padding: 6px;"></td>
      </tr>
    </table>
    <div style="text-align: right; margin-top: 16px;">
      <button class="btn btn-primary" onclick="submitCreateEvent()">Создать</button>
      <button class="btn btn-secondary" onclick="closeCreateEventModal()">Отмена</button>
    </div>
  </div>
</div>

</div>


  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>

<tr>
  <td style="width: 2%;"><i class="bi bi-person-lines-fill"></i></td>
  <td style="width: 32%;" class="text-end" colspan="2">
    <label class="form-label fw-semibold">Ник последнего активировавшего событие</label>
  </td>
  <td colspan="1" style="width: 32%;">
    <input
      type="text"
      id="event-user-file-path"
      class="form-control form-control-sm"
      readonly
      style="cursor: pointer;"
      title="Нажмите, чтобы скопировать путь"
      onclick="copyEventUserFilePath()"
    />
    </td><td id="last-event-user" style="vertical-align: middle; padding-left: 30px; font-weight: bold; color: #444;">—</td>
</tr>

      </tbody>
    </table>
  </div>




</div>

<!-- Клипы -->
<div class="tab-pane" id="clips">


  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Настройки</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>

        <tr>
          <td style="width: 2%;">
            <i class="bi bi-volume-up-fill"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="vlcVolumeSlider">Громкость клипа:<span id="vlcVolumeLabel" style="display:inline-block; min-width: 10.94em; text-align: right;">60</span>%</label>
          </td>
          <td style="width: 30%;">
              <input type="range" class="form-control-range" style="margin: 0px; display: inline-block;" id="vlcVolumeSlider" min="0" max="100" value="0" oninput="onVlcVolumeSliderChange(this.value)">
          </td>
          <td rowspan="4" style="text-align: center; vertical-align: middle; padding-left: 40px;"><button class="btn btn-primary" id="toggleQueueBtn">Показать очередь</button></td>
        </tr>

        <tr>
          <td style="width: 2%;">
            <i class="bi bi-broadcast-pin"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="volumeSlider">Громкость в OBS:<span id="volumeLabel" style="display:inline-block; min-width: 10.8em; text-align: right;">60</span>%</label>
          </td>
          <td style="width: 30%;">
              <input type="range" class="form-control-range" style="margin-right: 2px; margin: 0px; display: inline-block;" id="volumeSlider" min="0" max="100" value="0" oninput="onVolumeSliderChange(this.value)">
          </td>
          <td></td>
        </tr>

        <tr>
          <td style="width: 2%;">
            <i class="bi bi-clock-history"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="maxVideoLength" style="margin-right: 3px;">Длина видео до (мин):</label>
          </td>
          <td style="width: 30%;">
              <input type="number" class="form-control centry" style="display: inline-block;" id="maxVideoLength" min="1" value="10" onchange="onMaxVideoLengthChange(this.value)">
          </td>
          <td></td>
        </tr>

        <tr>
          <td style="width: 2%;">
            <i class="bi bi-eye-fill"></i>
          </td>
          <td class="text-end" style="width: 28%;">
            <label for="minViews" style="margin-right: 8px;">Число просмотров от:</label>
          </td>
          <td style="width: 30%;">
              <input type="number" class="form-control centry" style="display: inline-block;" id="minViews" min="1" value="1000" onchange="onMinViewsChange(this.value)">
          </td>
          <td></td>
        </tr>

      </tbody>
    </table>
  </div>


	  
  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Избранное</h6>
 

 <div class="card card-chart">

<div id="playlistControls" style="margin: 2px 8px;">
  <select id="playlistSelect" style="outline: none;">
    <option value="">Все плейлисты</option>
  </select>
  <button class="btn btn-secondary btn-round custom-btn btn-16" id="btnToggleAutoAdd" disabled style="padding: 2px 7px 2px 2px; width: 13%; height: 30px;" title="Авто-добавлять клипы из выбранного плейлиста при пустой очереди">▶️ Авто</button>
  <button class="btn btn-primary btn-round custom-btn btn-16" id="btnAddPlaylist" style="width: 9%; height: 30px;">➕</button>
  <button class="btn btn-primary btn-round custom-btn btn-16" id="btnEditPlaylist" disabled style="width: 9%; height: 30px;">✏️</button>
</div>

<!-- Модальное окно создания -->
<div id="modalAdd" class="modal-bg">
  <div class="modal" style="display: block;">
    <h2>Создать плейлист</h2>
    <input id="inputAddName" type="text" placeholder="Имя плейлиста" />
    <div class="buttons">
      <button id="confirmAdd" class="btn btn-primary" style="width: 26%;">Создать</button>
      <button id="cancelAdd" class="btn btn-secondary">Отмена</button>
    </div>
  </div>
</div>

<!-- Модальное окно редактирования -->
<div id="modalEdit" class="modal-bg">
  <div class="modal" style="display: block;">
    <h2>Редактировать плейлист</h2>
    <input id="inputEditName" type="text" placeholder="Новое имя плейлиста" />
    <div class="buttons">
      <button id="btnDeletePlaylist" class="btn btn-danger" style="width: 26%;">Удалить</button>
      <div style="flex-grow: 1"></div>
      <button id="confirmEdit" class="btn btn-primary" style="width: 30%;">Сохранить</button>
      <button id="cancelEdit" class="btn btn-secondary">Отмена</button>
    </div>
  </div>
</div> 

<div id="favoritesList" class="p-2 mb-3" style="background: #252525; max-height: 343px; height: 343px; margin: 2px 8px; overflow-y: auto; box-shadow: -0.25em -0.25em 0.25em hsl(223deg 3.65% 18.13%) inset, 0.0625em 0.0625em 0.875px 0.125em hsl(0deg 0% 6.72%), 0.125em 0.25em 0.25em hsl(var(--hue), 10%, 5%) inset, -0.0625em -0.0625em 0.125em hsla(var(--hue), 10%, 5%);"></div>

</div>


<div id="clearQueueModal" class="modal-bg" style="display: none;">
  <div class="modal" style="max-width: 400px;">
    <h2 style="margin-bottom: 16px;">Очистить очередь?</h2>
    <p>Вы действительно хотите очистить очередь клипов?</p>
    <div style="margin-top: 24px; text-align: right;">
      <button onclick="confirmClearQueueNow()" style="width: 28%;" class="btn btn-danger">Очистить</button>
      <button onclick="closeClearQueueModal()" style="width: 28%;" class="btn btn-secondary">Отмена</button>
    </div>
  </div>
</div>


  <hr class="my-4">
  <h6 class="mb-3" style="text-align: right;">Очередь</h6>


 <div class="card card-chart" style="max-height: 204px; height: 204px;">

<div class="row" style="border-bottom: 3px solid #3b3b3b; margin:6px 0px 7px 0px; display: flex; justify-content: center; align-items: center;">
  <div class="col-md-12 text-center" style="margin-left: 320px;">
    <button class="btn btn-primary btn-round custom-btn btn-16" onclick="pauseVideo()" style="font-size: 12px;">⏸ <br>Пауза\Пуск</button>
  <button class="btn btn-primary btn-round custom-btn btn-16" onclick="stopVideo()" style="font-size: 12px;">⏹ <br>Стоп</button>
    <button class="btn btn-primary btn-round custom-btn btn-16" onclick="resumeVideo()" style="font-size: 12px;">▶ <br>Запуск</button>
    <button class="btn btn-primary btn-round custom-btn btn-16" onclick="skipVideo()" style="font-size: 12px;">⏭ <br>Скип</button>
    <button class="btn btn-danger" onclick="openClearQueueModal()" style="font-size: 13px; margin-left: 200px; width: 130px; height: 40px; padding: 0; color: aliceblue;
    font-weight: 500;">
        Очистить очередь
    </button>
  </div>
</div>

<div class="row mt-4 " style="text-align: left; padding-right: 15px;">
  <div id="MiniList" style="padding: 0px 0px 0px 4px; max-height: 130px; overflow-y: auto; display: flex; gap: 5px; width: 100%;">
    <div class="col-md-4" style="padding-right: 0; max-width: 33%;">
      <ul class="list-group" id="queueMiniLeft" style="padding: 0; margin: 0;"></ul>
    </div>
    <div class="col-md-4" style="padding: 0; max-width: 33%;">
      <ul class="list-group" id="queueMiniCenter" style="padding: 0; margin: 0;"></ul>
    </div>
    <div class="col-md-4" style="padding-left: 0; max-width: 33%; padding-right: 4px;">
      <ul class="list-group" id="queueMiniRight" style="padding: 0; margin: 0;"></ul>
    </div>
  </div>
</div>
</div>


      <!-- HTML модального окна (добавь в тело страницы) -->
      <div id="modalConfirmClipDelete" style="
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.6);
        justify-content: center;
        align-items: center;
        z-index: 9999;">
        <div style="
          background: #222;
          padding: 20px;
          border-radius: 10px;
          width: 320px;
          color: #fff;
          font-family: sans-serif;
          text-align: center;
          box-shadow: 0 0 15px #000;">
          <div id="clipDeleteMessage" style="margin-bottom: 20px; font-size: 16px;"></div>
          <button id="confirmDeleteClip" class="btn btn-danger">Удалить</button>
          <button id="cancelDeleteClip" class="btn btn-secondary">Отмена</button>
        </div>
      </div>

    <!-- Модальное окно добавления в плейлист -->
    <div id="addToPlaylistModal" class="modal-bg">
      <div class="modal" style="margin: 45% 21%;">
        <h2>Добавить в плейлист</h2>
        <label for="playlistSelectModal">Выберите плейлист:</label>
        <select id="playlistSelectModal" style="width: 100%; margin: 8px 0 16px 0; padding: 8px; border-radius: 4px; border: none;"></select>
        <div class="buttons">
          <button id="btnConfirmAddToPlaylist">Добавить</button>
          <button id="btnCancelAddToPlaylist">Отмена</button>
        </div>
      </div>
    </div>
			


</div>


<!-- Роли -->
<div class="tab-pane" id="roles">

    <hr class="my-4">
    <h6 class="mb-3" style="text-align: right;">Доступные команды модератора</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>

    <div style="user-select: text; font-family: Arial, sans-serif; font-size: 14px; background-color: #111111; color: #ffffff; padding: 10px 8px 10px 8px; border-radius: 12px; box-shadow: -0.1em -0.1em 0.15em hsl(var(--hue), 10%, 30%), 0.1em 1.2px 0.1em 0.1em hsl(220deg 10.86% 30.00%) inset, 0.1em 0.1em 0.1em hsl(var(--hue), 10%, 30%), -0.1em -0.1em 0.1em hsl(var(--hue), 10%, 30%) inset;">

      <h2 class="toggle">🎮 Управления</h2>
      <div class="cmd-list">
        <div class="cmd-row">
          <div class="cmd-col">!next</div>
          <div class="cmd-col">!скип</div>
          <div class="cmd-col"></div>
          <div class="cmd-desc">— пропустить текущий клип</div>
        </div>
        <div class="cmd-row">
          <div class="cmd-col">!pause</div>
          <div class="cmd-col">!пауза</div>
          <div class="cmd-col"></div>
          <div class="cmd-desc">— поставить клип на паузу</div>
        </div>
        <div class="cmd-row">
          <div class="cmd-col">!play</div>
          <div class="cmd-col">!плей</div>
          <div class="cmd-col"></div>
          <div class="cmd-desc">— продолжить воспроизведение клипа</div>
        </div>
        <div class="cmd-rw">
          <div class="cmd-col">!клипдня</div>
          <div class="cmd-desc">— добавит случайный клип из избранного</div>
        </div>
        <div class="cmd-rw">
          <div class="cmd-col">!переместить [откуда] [куда]</div>
          <div class="cmd-desc">— переместить клип с позиции №1 очереди на №2</div>
        </div>
        <div class="cmd-rw">
          <div class="cmd-col">!громкость [+число] или [-число]</div>
          <div class="cmd-desc">— изменить уровень громкости клипа на %</div>
        </div>
        <div class="cmd-rw">
          <div class="cmd-col">!заказать [ссылка/название]</div>
          <div class="cmd-desc">— заказать клип по ссылке или по названию</div>
        </div>    
        <div class="cmd-rw">
          <div class="cmd-col">!удалить [номер клипа]</div>
          <div class="cmd-desc">— удалить клип из очереди</div>
        </div>
      </div>


      <h2 class="toggle">📊 Информация</h2>
      <div class="cmd-list">
        <div class="cmd-ro">
          <div class="cmd-col">!очередь</div>
          <div class="cmd-desc">— вывести очередь клипов [в чат]</div>
        </div>
        <div class="cmd-ro">
          <div class="cmd-col">!кто</div>
          <div class="cmd-desc">— вывеси кто заказал текущий клип [в чат]</div>
        </div>
        <div class="cmd-ro">
          <div class="cmd-col">!инфо</div>
          <div class="cmd-desc">— вывести текущие условия для заказа клипа [в чат]</div>
        </div>
        <div class="cmd-ro">
          <div class="cmd-col">!топ</div>
          <div class="cmd-desc">— вывод ТОП 5 заказчиков клипов [в чат]</div>
        </div>
        <div class="cmd-ro">
          <div class="cmd-col">!зрители</div>
          <div class="cmd-desc">— вывести список активных зрителей из VK Play и Twitch [в чат]</div>
        </div>
        <div class="cmd-ro">
          <div class="cmd-col">!модераторы</div>
          <div class="cmd-desc">— вывести список пользователей с правами модератора [в чат]</div>
        </div>
      </div>
    </div>

      </tbody>
    </table>
  </div>


    <hr class="my-4">
    <h6 class="mb-3" style="text-align: right;">Список модераторов</h6>

  <div class="table-responsive card card-chart">
    <table class="table table-borderless align-middle">
      <tbody>

    <ul id="rolesList" style="max-height: 264px;height: 264px;margin-bottom: 4px;overflow-y: auto;padding: 0px 8px 0px 6px;margin-top: 6px;"></ul>

    <button id="btnAddRole" class="btn btn-primary btn-16" style="padding: 5px; font-size: 15px; width: 98%; margin-left: 1%;">Добавить модератора</button>
      </tbody>
    </table>
  </div>

      <!-- Модальное окно добавления ника -->
      <div id="modalAddRole" class="modal-bg" style="display:none;">
        <div class="modal">
          <h2>Добавить модератора</h2>
            <div style="display: flex; align-items: center; gap: 10px;">
              <img id="platformIcon" src="svg/vk.png" style="width: 24px;">
              <select id="selectPlatform">
                <option value="vk">VK</option>
                <option value="twitch">Twitch</option>
              </select>
            </div>
          <hr class="my-4">
          <input id="inputRoleName" type="text" placeholder="Введите точное имя модератора">
          <div class="buttons">
            <button id="configAddRole" class="btn btn-primary" style="width: 29%">Добавить</button>
            <button id="cancelAddRole" class="btn btn-danger">Отмена</button>
          </div>
        </div>
      </div>

      <div id="modalConfirmDelete" style="display: none; position: fixed; top: 0; left: 0; 
        width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; 
        align-items: center; z-index: 9999;">
        <div style="background-color: #2c2c2c; padding: 20px; border-radius: 10px; color: white; text-align: center;">
          <p id="deleteMessage" style="margin-bottom: 20px;">Вы уверены, что хотите удалить?</p>
          <button id="confirmDelete" class="btn btn-danger">Удалить</button>
          <button id="cancelDelete" class="btn btn-secondary" style="margin-left: 10px;">Отмена</button>
        </div>
      </div>



</div>

<!-- Отчеты -->
<div class="tab-pane" id="reports">

<style>
  #yearButtons button, #monthButtons button {
    margin-right: 6px;
    margin-bottom: 4px;
    padding: 0px 6px;
  }
#dateButtons button {
    margin-right: 4.2px;
    margin-bottom: 4px;
    width: 25px;
  } 
#yearButtons button.active,
#monthButtons button.active,
#dateButtons button.active {
  background-color: var(--primary-color);
  color: black; /* чтобы текст был читаемым, если фон яркий */
}
#platformFilter button.active {
  background-color: var(--primary-color);
  color: black;
}
</style>

<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Отчетная дата</h6>

<div class="card card-chart" style="padding: 0px 12px 6px 12px;">
<table border="1" style="margin-top:6px;">
  <thead style="">
    <tr>
      <th style="width: 102px;">Год</th>
      <th><div id="yearButtons"></div></th>
    </tr>
    <tr>
      <th>Месяц</th>
      <th><div id="monthButtons"></div></th>
    </tr>
    <tr>
      <th>Число</th>
      <th><div id="dateButtons"></div></th>
    </tr>
    <tr>
      <th>Платформа</th>
      <th><div id="platformFilter" style="margin-bottom: 4px;">
  <button onclick="filterByPlatform(null)" style="padding: 0px 6px;">Все</button>
  <button onclick="filterByPlatform('Twitch')" style="padding: 0px 6px;">Twitch</button>
  <button onclick="filterByPlatform('VK')" style="padding: 0px 6px;">VK</button></div></th>
    </tr>
    <tr>
      <th>Имя</th>
      <th><input type="text" id="searchInput" placeholder="Поиск по имени..." oninput="onSearchInput(this.value)" style="margin-bottom: 4px; width: 300px;"></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>



</div>

<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Список зрителей</h6>

<div class="card card-chart" style="padding: 6px 6px 12px 12px;">
  <div id="authorsScroll" style="max-height: 474px; height: 474px; overflow-y: auto;">
    <table id="viewersTable" style="width:100%;">
      <thead>
        <tr>
          <th style="margin: 0px 4px; padding: 1px 10px 5px 10px; font-weight: 900; color: var(--primary-color); width: 3%; position: sticky; top: 0; background: #212121; z-index: 1;">I</th>
          <th style="padding: 1px 0px 5px 0px; font-weight: 900; color: var(--primary-color); width: 50%; position: sticky; top: 0; background: #212121; z-index: 1;">Имя</th>
          <th style="padding: 1px 0px 5px 0px; font-weight: 900; color: var(--primary-color); width: 18%; position: sticky; top: 0; background: #212121; z-index: 1;">Онлайн <small>(~минуты)</small></th>
          <th style="padding: 1px 0px 5px 0px; font-weight: 900; color: var(--primary-color); position: sticky; top: 0; background: #212121; z-index: 1;">Вход <small>(~время)</small></th>
          <th style="padding: 1px 0px 5px 0px; font-weight: 900; color: var(--primary-color); position: sticky; top: 0; background: #212121; z-index: 1;">Удержание <small>(%)</small></th>
        </tr>
      </thead>
      <tbody style="font-size: 15px;"></tbody>
    </table>
  </div>
</div>

<hr class="my-4">
<h6 class="mb-3" style="text-align: right;">Обновление данных</h6>

<div class="card card-chart" style="padding: 6px 8px 8px 8px;">
<button id="refreshButton" class="btn btn-primary" style="color: black;">Обновить данные</button>
</div>

<script>

  async function openAlerts(event) {
    event.preventDefault(); // чтобы ссылка не срабатывала сразу
    const url = await window.pywebview.api.get_twitch_alert_url();
    if (url) {
      window.open(url, '_blank');
    } else {
      alert('Канал не задан!');
    }
  }



function updateDropPercentThresholdSlider(value) {
    const slider = document.getElementById("dropPercentThresholdSlider");
    const label = document.getElementById("dropPercentThresholdLabel");
    slider.value = value;
    label.innerText = parseFloat(value).toFixed(1);
}
function onDropPercentThresholdSliderChange(value) {
    const parsedValue = parseFloat(value).toFixed(1);
    document.getElementById("dropPercentThresholdLabel").innerText = parsedValue;
    if (window.pywebview) {
        window.pywebview.api.set_drop_percent_threshold(parsedValue)
            .then(response => {
                if (response.status !== "ok") {
                    console.error("Ошибка сохранения порога потерь кадров:", response.error);
                    alert("Ошибка сохранения порога потерь кадров: " + response.error);
                }
            })
            .catch(error => {
                console.error("Ошибка при вызове set_drop_percent_threshold:", error);
                alert("Ошибка при сохранении настроек: " + error);
            });
    }
}
function loadObsSettings() {
    if (window.pywebview) {
        window.pywebview.api.get_drop_percent_threshold()
            .then(response => {
                if (response.status === "ok") {
                    updateDropPercentThresholdSlider(response.drop_percent_threshold);
                } else {
                    console.error("Ошибка загрузки настроек OBS:", response.error);
                }
            })
            .catch(error => {
                console.error("Ошибка при загрузке настроек OBS:", error);
            });
    }
}
window.addEventListener("load", loadObsSettings);







let platformFilter = null;
let searchQuery = "";

function filterByPlatform(platform) {
  platformFilter = platform;
  showViewersTable();
  document.querySelectorAll('#platformFilter button').forEach(btn => {
    btn.classList.remove('active');
    const btnPlatform = btn.textContent;
    if ((platform === null && btnPlatform === 'Все') || btnPlatform === platform) {
      btn.classList.add('active');
    }
  });
}

function onSearchInput(value) {
  searchQuery = value.toLowerCase();
  showViewersTable();
}

let reportsData = {};
let allFiles = [];
let currentYear = null;
let currentMonthFile = null;
let currentDate = null;

async function loadAvailableReports(files) {
  allFiles = files.sort().reverse();
  const years = [...new Set(allFiles.map(f => f.split('-')[1]))].sort();
  const yearButtons = document.getElementById("yearButtons");
  yearButtons.innerHTML = "";
  years.forEach(year => {
    const btn = document.createElement("button");
    btn.textContent = year;
    btn.onclick = () => {
      selectYear(year, /*selectCurrentDay=*/ false);
      yearButtons.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    };
    yearButtons.appendChild(btn);
  });

  const today = new Date();
  const thisYear = today.getFullYear().toString();

  if (years.includes(thisYear)) {
    // При старте выбираем год с выбором текущего дня
    selectYear(thisYear, /*selectCurrentDay=*/ true);
    yearButtons.querySelectorAll("button").forEach(b => {
      if (b.textContent === thisYear) b.classList.add("active");
    });
  } else if (years.length) {
    selectYear(years[0], /*selectCurrentDay=*/ false);
    yearButtons.querySelectorAll("button").forEach(b => {
      if (b.textContent === years[0]) b.classList.add("active");
    });
  }
}

function selectYear(year, selectCurrentDay) {
  currentYear = year;
  currentMonthFile = null;
  currentDate = null;

  const monthsFiles = allFiles.filter(f => f.includes(`-${year}-`)).sort();
  const monthButtons = document.getElementById("monthButtons");
  monthButtons.innerHTML = "";
  monthsFiles.forEach(file => {
    const month = file.split('-')[0];
    const btn = document.createElement("button");
    btn.textContent = month;
    btn.onclick = () => {
      selectMonth(file, /*selectCurrentDay=*/ false);
      monthButtons.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    };
    monthButtons.appendChild(btn);
  });

  document.getElementById("dateButtons").innerHTML = "";
  clearTable();

  if (monthsFiles.length) {
    if (selectCurrentDay) {
      // При старте выбираем текущий месяц и текущий день
      const today = new Date();
      const thisMonth = (today.getMonth() + 1).toString().padStart(2, "0");
      const targetFile = monthsFiles.find(f => f.startsWith(thisMonth)) || monthsFiles[0];
      const targetMonth = targetFile.split("-")[0];
      selectMonth(targetFile, /*selectCurrentDay=*/ true);
      monthButtons.querySelectorAll("button").forEach(b => {
        if (b.textContent === targetMonth) b.classList.add("active");
      });
    } else {
      // Просто выбираем первый месяц без выбора дня
      selectMonth(monthsFiles[0], /*selectCurrentDay=*/ false);
      monthButtons.querySelectorAll("button").forEach(b => {
        if (b.textContent === monthsFiles[0].split("-")[0]) b.classList.add("active");
      });
    }
  }
}

async function selectMonth(file, selectCurrentDay) {
  currentMonthFile = file;
  if (!reportsData[file]) {
    reportsData[file] = await window.pywebview.api.load_report_file(file);
  }
  const records = reportsData[file];
  const dates = [...new Set(records.map(r => r.date))].sort();
  const dateButtons = document.getElementById("dateButtons");
  dateButtons.innerHTML = "";

  dates.forEach(date => {
    const btn = document.createElement("button");
    btn.textContent = date.slice(-2);
    btn.onclick = () => {
      currentDate = date;
      dateButtons.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      showViewersTable();
    };
    dateButtons.appendChild(btn);
  });

  if (selectCurrentDay) {
    const today = new Date().toISOString().slice(0, 10);
    currentDate = dates.includes(today) ? today : dates[0];
    if (currentDate) {
      dateButtons.querySelectorAll("button").forEach(b => {
        if (b.textContent === currentDate.slice(-2)) b.classList.add("active");
      });
    }
  } else {
    currentDate = null;
  }
  showViewersTable();
}


function showMonthView() {
  if (!currentMonthFile) {
    clearTable();
    return;
  }
  const records = reportsData[currentMonthFile];
  const viewerData = {};
  records.forEach(r => {
    if (!viewerData[r.name]) {
      viewerData[r.name] = {
        count: 0,
        firstTime: r.time,
        platform: r.platform
      };
    }
    viewerData[r.name].count += 1;
    if (r.time < viewerData[r.name].firstTime) {
      viewerData[r.name].firstTime = r.time;
    }
  });
  const dataArray = Object.entries(viewerData).map(([name, data]) => ({
    name,
    minutes: data.count * 3,
    firstTime: data.firstTime,
    platform: data.platform
  }));
  const maxMinutes = Math.max(...dataArray.map(d => d.minutes)) || 1;
  dataArray.forEach(d => {
    d.retention = Math.round((d.minutes / maxMinutes) * 100);
  });
  let filteredData = dataArray;
  if (platformFilter) {
    filteredData = filteredData.filter(d => d.platform === platformFilter);
  }
  if (searchQuery) {
    filteredData = filteredData.filter(d => d.name.toLowerCase().includes(searchQuery));
  }

  filteredData.sort((a, b) => {
    const key = currentSort.key;
    const dir = currentSort.direction;
    if (a[key] < b[key]) return -1 * dir;
    if (a[key] > b[key]) return 1 * dir;
    return 0;
  });

  const tbody = document.querySelector("#viewersTable tbody");
  tbody.innerHTML = "";
  filteredData.forEach(({ name, minutes, firstTime, platform, retention }) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${getPlatformIcon(platform)}</td>
      <td>${name}</td>
      <td>${minutes}</td>
      <td>${firstTime}</td>
      <td>${retention}%</td>
    `;
    tr.style.borderBottom = "1px solid #3d3d3d";
    tbody.appendChild(tr);
  });
}


function selectDate(date) {
  currentDate = date;
  showViewersTable();
}
function clearTable() {
  document.querySelector("#viewersTable tbody").innerHTML = "";
}
let currentSort = { key: "name", direction: 1 };
function showViewersTable() {
  if (!currentMonthFile) {
    clearTable();
    return;
  }
  const records = currentDate
    ? reportsData[currentMonthFile].filter(r => r.date === currentDate)
    : reportsData[currentMonthFile];
  if (!records.length) {
    clearTable();
    return;
  }
  const viewerData = {};
  records.forEach(r => {
    if (!viewerData[r.name]) {
      viewerData[r.name] = {
        count: 0,
        firstTime: r.time,
        platform: r.platform
      };
    }
    viewerData[r.name].count += 1;
    if (r.time < viewerData[r.name].firstTime) {
      viewerData[r.name].firstTime = r.time;
    }
  });
  const dataArray = Object.entries(viewerData).map(([name, data]) => ({
    name,
    minutes: data.count * 3,
    firstTime: data.firstTime,
    platform: data.platform
  }));
  const maxMinutes = Math.max(...dataArray.map(d => d.minutes)) || 1;
  dataArray.forEach(d => {
    d.retention = Math.round((d.minutes / maxMinutes) * 100);
  });
  let filteredData = dataArray;
  if (platformFilter) {
    filteredData = filteredData.filter(d => d.platform === platformFilter);
  }
  if (searchQuery) {
    filteredData = filteredData.filter(d => d.name.toLowerCase().includes(searchQuery));
  }
  filteredData.sort((a, b) => {
    const key = currentSort.key;
    const dir = currentSort.direction;
    if (a[key] < b[key]) return -1 * dir;
    if (a[key] > b[key]) return 1 * dir;
    return 0;
  });
  const tbody = document.querySelector("#viewersTable tbody");
  tbody.innerHTML = "";
  filteredData.forEach(({ name, minutes, firstTime, platform, retention }) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${getPlatformIcon(platform)}</td>
      <td>${name}</td>
      <td>${minutes}</td>
      <td>${firstTime}</td>
      <td>${retention}%</td>
    `;
    tr.style.borderBottom = "1px solid #3d3d3d";
    tbody.appendChild(tr);
  });
}

document.querySelectorAll("#viewersTable thead th").forEach((th, index) => {
  th.style.cursor = "pointer";
  th.onclick = () => {
    const keys = ["platform", "name", "minutes", "firstTime", "retention"];
    const key = keys[index];
    if (!key) return;
    if (currentSort.key === key) {
      currentSort.direction *= -1;
    } else {
      currentSort.key = key;
      currentSort.direction = 1;
    }
    showViewersTable();
  };
});
function getPlatformIcon(platform) {
  const icons = {
    Twitch: '<img src="svg/Twitch.png" alt="Twitch" width="20">',
    VK: '<img src="svg/vk.png" alt="VK" width="20">'
  };
  return icons[platform] || '';
}
document.getElementById("refreshButton").onclick = async () => {
  reportsData = {};
  allFiles = await window.pywebview.api.get_report_files();
  await loadAvailableReports(allFiles);
};
window.pywebview.api.get_report_files().then(loadAvailableReports);
</script>


</div>


<!-- Логи -->
<div class="tab-pane" id="logs">
  <textarea class="form-control mt-2" id="log" rows="10" readonly
    style="background-color: #252525; color: #dadada; font-size: 13px; line-height: 1.4; max-height: 800px; height: 800px;">
  </textarea>
</div>
</div>

 <!--  <footer class="text-end text-muted mt-4">
    Ars Aeterna — &copy; <script>document.write(new Date().getFullYear())</script> Сделано для стримов ❤️
  </footer>-->
</div>


<script src="script.js?v={{ timestamp }}" defer></script>


<script>


let zoomLevel = 1.0;
let baseWidth;
let baseHeight;

function setZoom(level) {
  if (typeof baseWidth !== 'number' || typeof baseHeight !== 'number') {
    console.warn('baseWidth or baseHeight is not set correctly');
    return;
  }
  zoomLevel = Math.max(0.5, Math.min(2.0, level));
  document.body.style.zoom = zoomLevel;
  const newWidth = Math.round(baseWidth * zoomLevel);
  const newHeight = Math.round(baseHeight * zoomLevel);
  if (window.pywebview?.api?.resize_window) {
    window.pywebview.api.resize_window(newWidth, newHeight);
  }
  if (window.pywebview?.api?.set_zoom_level) {
    window.pywebview.api.set_zoom_level(zoomLevel);
  }
}
// Клавиши Ctrl + ↑ / ↓
document.addEventListener("keydown", (e) => {
  if (e.ctrlKey && e.code === "ArrowUp") {
    e.preventDefault();
    setZoom(zoomLevel + 0.05);
  } else if (e.ctrlKey && e.code === "ArrowDown") {
    e.preventDefault();
    setZoom(zoomLevel - 0.05);
  }
});
// Кнопки + и −
document.getElementById("zoomInBtn").addEventListener("click", () => {
  setZoom(zoomLevel + 0.05);
});
document.getElementById("zoomOutBtn").addEventListener("click", () => {
  setZoom(zoomLevel - 0.05);
});
// Инициализация с данными от Python
function initializeZoom(width, height, zoom) {
  baseWidth = width;
  baseHeight = height;
  zoomLevel = zoom || 1.0;
  setZoom(zoomLevel);
}








function openClearQueueModal() {
  document.getElementById("clearQueueModal").style.display = "flex";
}
function closeClearQueueModal() {
  document.getElementById("clearQueueModal").style.display = "none";
}
async function confirmClearQueueNow() {
  await window.pywebview.api.clear_video_queue();
  closeClearQueueModal();
}


let editingAuthorIndex = null;
let authorsList = [];
// Открыть модалку со списком авторов
async function openAuthorsModal() {
  authorsList = await window.pywebview.api.get_author_tts();
  renderAuthorsTable();
  document.getElementById("modalAuthors").style.display = "flex";
}
// Закрыть модалку авторов
function closeAuthorsModal() {
  document.getElementById("modalAuthors").style.display = "none";
}
// Отрисовка таблицы авторов
function renderAuthorsTable() {
  const tbody = document.querySelector("#authorsTable tbody");
  tbody.innerHTML = "";
  authorsList.forEach((entry, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${entry.name}</td>
      <td>${entry.speak_as}</td>
      <td>
        <button onclick="editAuthor(${index})" class="btn btn-primary" style="width: 42%; height: 20px; padding: 0;">✏️</button>
        <button onclick="confirmDeleteAuthor(${index})" class="btn btn-primary" style="width: 42%; height: 20px; padding: 0;">🗑</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
// Открыть модалку добавления автора
function openAddAuthorModal() {
  editingAuthorIndex = null;
  document.getElementById("authorModalTitle").innerText = "Добавить имя";
  document.getElementById("authorNameInput").value = "";
  document.getElementById("speakAsInput").value = "";
  document.getElementById("authorTtsModal").style.display = "flex";
}
// Закрыть модалку автора
function closeAuthorModal() {
  document.getElementById("authorTtsModal").style.display = "none";
}
// Редактировать автора
function editAuthor(index) {
  editingAuthorIndex = index;
  const entry = authorsList[index];
  document.getElementById("authorModalTitle").innerText = "Редактировать имя";
  document.getElementById("authorNameInput").value = entry.name;
  document.getElementById("speakAsInput").value = entry.speak_as;
  document.getElementById("authorTtsModal").style.display = "flex";
}
// Сохранить (добавить или обновить) автора
async function saveAuthor() {
  const name = document.getElementById("authorNameInput").value.trim();
  const speak_as = document.getElementById("speakAsInput").value.trim();
  if (!name || !speak_as) {
    alert("Заполните оба поля");
    return;
  }
  if (editingAuthorIndex === null) {
    await window.pywebview.api.add_author_tts({ name, speak_as });
  } else {
    await window.pywebview.api.update_author_tts(editingAuthorIndex, { name, speak_as });
  }
  closeAuthorModal();
  await openAuthorsModal(); // обновить таблицу
}
// Загрузка и скрытие таблицы при старте
async function loadAuthorTTS() {
  await openAuthorsModal();
  await closeAuthorsModal();
}
// ======= Удаление автора (через модалку подтверждения) =======
let pendingDeleteAuthorIndex = null;
function confirmDeleteAuthor(index) {
  pendingDeleteAuthorIndex = index;
  const name = authorsList[index].name;
  document.getElementById("deleteAuthorDescription").innerText = `Удалить автора "${name}"?`;
  document.getElementById("deleteAuthorModal").style.display = "flex";
}
function closeDeleteAuthorModal() {
  document.getElementById("deleteAuthorModal").style.display = "none";
}
async function confirmDeleteAuthorNow() {
  if (pendingDeleteAuthorIndex !== null) {
    await window.pywebview.api.delete_author_tts(pendingDeleteAuthorIndex);
    await openAuthorsModal();
  }
  closeDeleteAuthorModal();
}



//кнопка очереди
const toggleBtn = document.getElementById('toggleQueueBtn');
async function updateButtonText() {
    const isVisible = await window.pywebview.api.is_queue_visible();
    toggleBtn.textContent = isVisible ? 'Скрыть очередь' : 'Показать очередь';
}
toggleBtn.addEventListener('click', async () => {
    await window.pywebview.api.toggle_queue_window();
    await updateButtonText();
});
setInterval(updateButtonText, 1500);



document.addEventListener('DOMContentLoaded', function () {
    const scriptTab = document.getElementById('script-tab');
    const modalObs = document.getElementById('modalObs');
    const closeModalBtn = document.getElementById('closeObsModal');

    scriptTab.addEventListener('click', async function (e) {
        e.preventDefault();

        if (window.pywebview && window.pywebview.api) {
            const isObsConnected = await window.pywebview.api.check_obs_connection();

            if (isObsConnected) {
                const tab = new bootstrap.Tab(scriptTab);
                tab.show();
            } else {
                modalObs.style.display = 'flex';
            }
        }
    });

    closeModalBtn.addEventListener('click', function () {
        modalObs.style.display = 'none';
    });
});

let scriptToDeleteIndex = null;
let scriptToDeleteName = '';

function deleteScript(idx) {
  const script = window.loadedScripts[idx];
  scriptToDeleteIndex = idx;
  scriptToDeleteName = script.name;
  document.getElementById('confirmDeleteTitle').textContent =
    `Вы действительно хотите удалить скрипт "${scriptToDeleteName}"?`;
  document.getElementById('confirmDeleteModal').style.display = 'flex';
}

function closeConfirmDeleteModal() {
  scriptToDeleteIndex = null;
  scriptToDeleteName = '';
  document.getElementById('confirmDeleteModal').style.display = 'none';
}

async function confirmDelete() {
  if (scriptToDeleteIndex !== null) {
    await window.pywebview.api.delete_script(scriptToDeleteIndex);
    closeConfirmDeleteModal();
    await loadScripts();
  }
}

function openCreateRewardModal() {
  document.getElementById("reward_script_name").value = "";
  document.getElementById("reward_name").value = "";
  document.getElementById("createRewardModal").style.display = "flex";
}

function closeCreateRewardModal() {
  document.getElementById("createRewardModal").style.display = "none";
}

async function submitCreateReward() {
  const name = document.getElementById("reward_script_name").value.trim();
  const reward = document.getElementById("reward_name").value.trim();
  if (!name || !reward) {
    alert("Пожалуйста, заполните оба поля.");
    return;
  }
  await window.pywebview.api.create_script({ name, reward, type: "reward" });
  closeCreateRewardModal(); // ✅ Закрываем модалку после создания
  await loadScripts();      // 🔄 Обновляем список
}

function openCreateEventModal() {
  document.getElementById("event_script_name").value = "";
  document.getElementById("event_name").value = "";
  document.getElementById("createEventModal").style.display = "flex";
}

function closeCreateEventModal() {
  document.getElementById("createEventModal").style.display = "none";
}

async function submitCreateEvent() {
  const name = document.getElementById("event_script_name").value.trim();
  const reward = document.getElementById("event_name").value.trim();
  if (!name || !reward) {
    alert("Пожалуйста, заполните оба поля.");
    return;
  }
  await window.pywebview.api.create_script({ name, reward, type: "event" });
  closeCreateEventModal();  // ✅ Закрываем модалку после создания
  await loadScripts();      // 🔄 Обновляем список
}


async function createScript(name, reward, type) {
  await window.pywebview.api.create_script({ name, reward, type });
  await loadScripts();
  const list = await window.pywebview.api.get_scripts();
  const lastIdx = list.length - 1;
  await showParams(lastIdx);
}

async function loadScripts() {
  const list = await window.pywebview.api.get_scripts();
  window.loadedScripts = list;
  const rewards = list.filter(script => script.type === "reward");
  const events = list.filter(script => script.type === "event");
  const renderGroup = (scripts, containerId, icon, color) => {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    scripts.forEach((script, idx) => {
      const div = document.createElement('div');
      div.innerHTML = `
        <table style="width: 100%; border-collapse: collapse;">
          <tr style="border-bottom: 1px solid #797979;">
            <td style="width: 40px; text-align: center; font-weight: bold;">${idx + 1}</td>
            <td style="width: 40px;">
              <span style="font-size: 18px;">${icon}</span>
            </td>
            <td style="padding: 2px 4px;">
              <div><strong>${script.name} </strong> <a style="font-size: 11px; color: #888888;"> [${script.reward}]</a></div>
            </td>
            <td style="text-align: right; white-space: nowrap;">
              <button class="btn btn-primary btn-round custom-btn btn-16" style="height: 26px;width: 80px;" onclick="testScript(${list.indexOf(script)})">▶ Пуск</button>
              <button class="btn btn-primary btn-round custom-btn btn-16" style="height: 26px;width: 150px;" onclick="openScriptEditor(${list.indexOf(script)})">⚙️ Редактировать</button>
              <button class="btn btn-danger" style="height: 26px;width: 100px; padding: 2px;" onclick="deleteScript(${list.indexOf(script)})">🗑 Удалить</button>
            </td>
            <td style="width: 0.5%"></td>
          </tr>
        </table>
      `;
      container.appendChild(div);
    });
  };

  renderGroup(rewards, "rewardScripts", "🎁", "#DAA520");
  renderGroup(events, "eventScripts", "🎉", "#1E90FF");
}

async function openScriptEditor(index) {
  const list = await window.pywebview.api.get_scripts();
  window.scripts = list;
  const script = list[index];
  const modal = document.getElementById('scriptModal');
  const modalContent = document.getElementById('modalContent');
  modalContent.innerHTML = `
    <h3 style="margin-bottom: 14px;">${script.name}</h3><div id="script_${index}_actions"></div>
    <div id="params_${index}"></div>
    <div style="text-align: right; margin-top: 10px;">
      <button class="btn btn-primary btn-round custom-btn btn-16" style="height: 32px;width: 190px;" onclick="addAction(${index})">➕ Добавить действие</button>
      <button class="btn btn-secondary" style="height: 32px;width: 100px; padding: 0;" onclick="closeModal()">Закрыть</button>
    </div>
  `;
  renderActions(index, script.actions);
  await showParams(index);
  modal.style.display = "flex";
}

function closeModal() {
  document.getElementById('scriptModal').style.display = "none";
}




// Переменные для drag & drop
let dragSrcEl = null;

// Функция рендера действий с поддержкой drag & drop
function renderActions(scriptIdx, actions) {
  const el = document.getElementById(`script_${scriptIdx}_actions`);
  let html = `
    <div style="max-height: 300px; height: 300px; overflow-y: auto; border: 1px solid #797979; border-radius: 4px;">
      <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
        <thead style="position: sticky; top: 0; background: #3b3b3b; color: var(--primary-color); z-index: 1;">
          <tr style="text-align: left; border-bottom: 1px solid #ccc;">
            <th style="width: 1%;"></th>
            <th style="width: 22%;">Тип</th>
            <th style="width: 44%;">Описание</th>
            <th style="width: 20%;">Задержка (мс)</th>
            <th style="width: 12%;">Действия</th>
          </tr>
        </thead>
        <tbody style="font-size: 14px; line-height: 1.3;">
  `;
  actions.forEach((a, i) => {
    const desc = a.type === "obs_switch_scene"
      ? `Сцена: <strong>${a.scene_name}</strong>`
      : a.type === "toggle_filter"
        ? `Источник: <strong>${a.source}</strong><br>Фильтр: <strong>${a.filter || "—"}</strong><br>Вкл: <strong>${a.enable}</strong>`
        : a.type === "volume_control"
          ? `Источник: <strong>${a.source}</strong><br>Громкость: <strong>${a.volume}</strong>`
          : a.type === "exec"
            ? `Код: <code>${(a.code?.substring(0, 40) || "").replace(/\n/g, ' ')}...</code>`
            : `<code>${JSON.stringify(a)}</code>`;
    html += `
      <tr draggable="true" id="action_${scriptIdx}_${i}" style="cursor: all-scroll; border-bottom: 1px solid #5f5f5f;">
        <td></td>
        <td><strong>${a.type}</strong></td>
        <td>${desc}</td>
        <td>
          <input type="number" id="delay_${scriptIdx}_${i}" value="${a.delay || 0}" onchange="autoSaveDelay(${scriptIdx}, ${i})" style="width: 90px; padding: 2px; margin: 0px;">
        </td>
        <td>
          <button class="btn btn-danger" style="width: 70%; height: 25px; padding: 0;" 
            onclick="showDeleteActionModal(${scriptIdx}, ${i})" title="Удалить действие">🗑</button>
        </td>
      </tr>
    `;
  });
  html += `
        </tbody>
      </table>
    </div>
  `;
  el.innerHTML = html;

  // Навешиваем обработчики drag & drop
  const rows = el.querySelectorAll('tr[draggable="true"]');
  rows.forEach(row => {
    row.addEventListener('dragstart', dragStart);
    row.addEventListener('dragover', dragOver);
    row.addEventListener('drop', drop);
    row.addEventListener('dragend', dragEnd);
  });
}

// Обработчики drag & drop

function dragStart(e) {
  dragSrcEl = this;
  e.dataTransfer.effectAllowed = 'move';
  e.dataTransfer.setData('text/html', this.innerHTML);
  this.style.opacity = '0.4';
}

function dragOver(e) {
  e.preventDefault(); // разрешаем drop
  e.dataTransfer.dropEffect = 'move';
  return false;
}

async function drop(e) {
  e.stopPropagation();
  if (dragSrcEl !== this) {
    const srcId = dragSrcEl.id;
    const targetId = this.id;
    const [_, scriptIdxStr, srcIndexStr] = srcId.split('_');
    const [__, scriptIdxStr2, targetIndexStr] = targetId.split('_');
    const scriptIdx = parseInt(scriptIdxStr, 10);
    const srcIndex = parseInt(srcIndexStr, 10);
    const targetIndex = parseInt(targetIndexStr, 10);
    if(window.scripts && window.scripts[scriptIdx]) {
      const actions = window.scripts[scriptIdx].actions;
      const movedAction = actions.splice(srcIndex, 1)[0];
      actions.splice(targetIndex, 0, movedAction);
      renderActions(scriptIdx, actions);
      // Сохраняем новый порядок на бекенде
      if(window.pywebview && window.pywebview.api) {
        await window.pywebview.api.save_scripts(window.scripts);
      }
    }
  }
  return false;
}

function dragEnd(e) {
  this.style.opacity = '1';
}

// ======= Удаление действий скрипта (не трогаем) =======
let pendingDeleteScriptIndex = null;
let pendingDeleteActionIndex = null;
  // Показывает модальное окно с подтверждением удаления
  function showDeleteActionModal(scriptIdx, actionIdx) {
    pendingDeleteScriptIndex = scriptIdx;
    pendingDeleteActionIndex = actionIdx;
    document.getElementById("deleteActionModal").style.display = "flex";
  }
  // Скрывает модальное окно подтверждения
  function closeDeleteActionModal() {
    document.getElementById("deleteActionModal").style.display = "none";
  }
  // Функция удаления действия из скрипта
  async function removeAction(scriptIdx, actionIdx) {
    // Здесь нужно вызвать API или изменить данные
    // Ниже просто пример с глобальным массивом scripts, замени под свой случай
    if(window.scripts && window.scripts[scriptIdx]) {
      window.scripts[scriptIdx].actions.splice(actionIdx, 1);
      renderActions(scriptIdx, window.scripts[scriptIdx].actions);
    } else {
      console.warn('Массив scripts или actions не определён');
    }
  }
  // Подтверждение удаления — кнопка "Удалить" в модальном окне
  async function confirmDeleteActionNow() {
    await removeAction(pendingDeleteScriptIndex, pendingDeleteActionIndex);
    closeDeleteActionModal();
  }
  // Навешиваем обработчики кнопок модального окна после загрузки страницы
  document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('#platformFilter button').forEach(btn => {
    if (btn.textContent === 'Все') {
      btn.classList.add('active');
    }
  });
    document.getElementById("confirmDeleteActionBtn").addEventListener("click", confirmDeleteActionNow);
    document.getElementById("cancelDeleteActionBtn").addEventListener("click", closeDeleteActionModal);
  });





async function autoSaveDelay(scriptIdx, actionIdx) {
  const delayInput = document.getElementById(`delay_${scriptIdx}_${actionIdx}`);
  if (!delayInput) return;
  const newDelay = parseInt(delayInput.value) || 0;

  if (window.scripts && window.scripts[scriptIdx] && window.scripts[scriptIdx].actions[actionIdx]) {
    window.scripts[scriptIdx].actions[actionIdx].delay = newDelay;

    if (window.pywebview && window.pywebview.api) {
      await window.pywebview.api.save_scripts(window.scripts);
    }
  }
}

async function addAction(index) {
  const sceneEl = document.getElementById(`scene_select_${index}`);
  if (!sceneEl || !sceneEl.value) return alert("Выберите сцену");
  const scene = sceneEl.value;

  const actionEl = document.getElementById(`action_select_${index}`);
  if (!actionEl || !actionEl.value) return alert("Выберите действие с сценой");
  const actionType = actionEl.value;

  let action = null;

  if (actionType === "switch_scene") {
    action = { type: "obs_switch_scene", scene_name: scene, delay: 0 };

  } else if (actionType === "exec") {
    const code = prompt("Введите JavaScript-код, который должен быть выполнен:");
    if (!code) return alert("Код не введён");
    action = { type: "exec", code, delay: 0 };

  } else if (actionType === "source_action") {
    const sourceEl = document.getElementById(`source_select_${index}`);
    if (!sourceEl || !sourceEl.value) return alert("Выберите источник");
    const source = sourceEl.value;

    const sourceActionEl = document.getElementById(`source_action_select_${index}`);
    if (!sourceActionEl || !sourceActionEl.value) return alert("Выберите действие с источником");
    const sourceAction = sourceActionEl.value;

    if (sourceAction === "show_hide_source") {
      const visibilityEl = document.getElementById(`visibility_select_${index}`);
      if (!visibilityEl || !visibilityEl.value) return alert("Выберите видимость источника");
      const enable = visibilityEl.value === "true";
      action = { type: "toggle_filter", source, filter: "", enable, delay: 0, scene };  // вот тут scene добавлено
    } else if (sourceAction === "filter_action") {
      const filterEl = document.getElementById(`filter_select_${index}`);
      if (!filterEl || !filterEl.value) return alert("Выберите фильтр");
      const filter = filterEl.value;
      const filterActionEl = document.getElementById(`filter_action_select_${index}`);
      if (!filterActionEl || !filterActionEl.value) return alert("Выберите действие с фильтром");
      const enable = filterActionEl.value === "enable";
      action = { type: "toggle_filter", source, filter, enable, delay: 0, scene };  // тут тоже добавлено scene
    } else if (sourceAction === "volume_control") {
      const volumeSlider = document.getElementById(`volume_slider_${index}`);
      if (!volumeSlider) return alert("Выберите громкость источника");
      const volume = parseInt(volumeSlider.value);
      action = { type: "volume_control", source, volume, delay: 0 };
    }

  } else if (actionType === "scene_filter_action") {
    const filterEl = document.getElementById(`filter_select_${index}`);
    if (!filterEl || !filterEl.value) return alert("Выберите фильтр");
    const filter = filterEl.value;
    const filterActionEl = document.getElementById(`filter_action_select_${index}`);
    if (!filterActionEl || !filterActionEl.value) return alert("Выберите действие с фильтром");
    const enable = filterActionEl.value === "enable";
    action = { type: "toggle_filter", source: scene, filter, enable, delay: 0, scene };
  }

  if (!action) return alert("Не выбрано действие для добавления");

  await window.pywebview.api.add_action_to_script(index, action);
  const scripts = await window.pywebview.api.get_scripts();
  window.scripts = scripts;  // <- обновляем глобальный массив
  renderActions(index, window.scripts[index].actions);
  await showParams(index);
  await loadScripts();
}




async function removeAction(scriptIdx, actionIdx) {
  if(window.scripts && window.scripts[scriptIdx]) {
    window.scripts[scriptIdx].actions.splice(actionIdx, 1);
    renderActions(scriptIdx, window.scripts[scriptIdx].actions);

    if(window.pywebview && window.pywebview.api && window.pywebview.api.save_scripts) {
      await window.pywebview.api.save_scripts(window.scripts);
    }
  }
}
function deleteScript(index) {
  const script = window.loadedScripts[index];
  scriptToDeleteIndex = index;
  scriptToDeleteName = script.name;
  document.getElementById('confirmDeleteTitle').textContent =
    `Вы действительно хотите удалить скрипт "${scriptToDeleteName}"?`;
  document.getElementById('confirmDeleteModal').style.display = 'flex';
}

async function testScript(index) {
    await window.pywebview.api.execute_script(index);
}
loadScripts();
async function populateScenes(index) {
    const res = await window.pywebview.api.get_obs_scenes();
    const container = document.getElementById(`params_${index}`);
    if (res.status === "ok") {
        const options = res.scenes.map(s => `<option value="${s}">${s}</option>`).join('');
        container.innerHTML = `
            <label>Сцена:</label>
            <select id="scene_${index}" onchange="loadSceneSources(${index})">${options}</select>
            <div id="scene_sources_${index}"></div>
        `;
        await loadSceneSources(index);
    } else {
        container.innerHTML = `<input id="scene_${index}" placeholder="Название сцены (ошибка OBS)">`;
    }
}
async function loadSceneSources(index) {
    const sceneName = document.getElementById(`scene_${index}`).value;
    const res = await window.pywebview.api.get_scene_sources(sceneName);
    const container = document.getElementById(`scene_sources_${index}`);
    if (res.status !== "ok") {
        container.innerHTML = `<div>Источники не найдены</div>`;
        return;
    }
    const blocks = await Promise.all(res.sources.map(async (source) => {
        const filtersRes = await window.pywebview.api.get_filters(source);
        const filters = filtersRes.status === "ok" ? filtersRes.filters : [];
        const filterOptions = filters.map(f => `<option value="${f}">${f}</option>`).join('');
        return `
            <div style="margin-top:10px; padding-left:15px; border-left:2px solid #ccc;">
                <h4>${source}</h4>
                <label>Задержка (мс):</label>
                <input type="number" id="delay_${index}_${source}" value="0" style="width:80px;">
                <br>
                <button onclick="addShowHide(${index}, '${source}', true)">👁 Показать</button>
                <button onclick="addShowHide(${index}, '${source}', false)">🙈 Скрыть</button>
                <br><br>
                <label>Фильтр:</label>
                <select id="filter_${index}_${source}">${filterOptions}</select>
                <button onclick="addFilterToggle(${index}, '${source}', true)">✅ Вкл</button>
                <button onclick="addFilterToggle(${index}, '${source}', false)">🚫 Выкл</button>
            </div>
        `;
    }));
    container.innerHTML = blocks.join('');
}
async function addShowHide(index, source, enable) {
    const delay = parseInt(document.getElementById(`delay_${index}_${source}`)?.value || 0);
    const action = {
        type: "toggle_filter",
        source: source,
        filter: "",
        enable: enable,
        delay: delay
    };
    console.log("Добавляем действие (показ/скрытие):", action);
    await window.pywebview.api.add_action_to_script(index, action);
    loadScripts();
}
async function addFilterToggle(index, source, enable) {
    const delay = parseInt(document.getElementById(`delay_${index}_${source}`)?.value || 0);
    const filterSelectId = `filter_${index}_${source}`;
    const filterEl = document.getElementById(filterSelectId);
    if (!filterEl || !filterEl.value) {
        console.warn("Нет фильтра, действие не добавлено");
        return;
    }
    const filter = filterEl.value;
    const action = {
        type: "toggle_filter",
        source: source,
        filter: filter,
        enable: enable,
        delay: delay
    };
    console.log("Добавляем действие (фильтр):", action);
    await window.pywebview.api.add_action_to_script(index, action);
    await loadScripts();
}

async function showParams(index) {
  const container = document.getElementById(`params_${index}`);
  container.innerHTML = `<em>Загрузка сцен...</em>`;
  const scenesRes = await window.pywebview.api.get_obs_scenes();
  if (scenesRes.status !== "ok" || scenesRes.scenes.length === 0) {
    container.innerHTML = `<div>Ошибка загрузки сцен</div>`;
    return;
  }
  renderSceneSelector(index, scenesRes.scenes);
}

function renderSceneSelector(index, scenes) {
  const container = document.getElementById(`params_${index}`);
  container.innerHTML = `
    <div style="display:flex; align-items:center; gap:8px; margin-top: 30px;">
      <label style="width: 60%;">Выберите сцену:</label>
      <select id="scene_select_${index}">
        <option value="">-- выберите сцену --</option>
        ${scenes.map(s => `<option value="${s}">${s}</option>`).join('')}
      </select>
    </div>
    <div id="step2_${index}" style="margin-top: 4px;"></div>
  `;
  document.getElementById(`scene_select_${index}`).onchange = (e) => handleSceneChange(index, e.target.value);
}

function handleSceneChange(index, sceneName) {
  const step2 = document.getElementById(`step2_${index}`);
  if (!sceneName) return step2.innerHTML = '';

  step2.innerHTML = `
    <div style="display:flex; align-items:center; gap:8px;">
      <label style="width: 60%;">Действие:</label>
      <select id="action_select_${index}">
        <option value="">-- выберите действие --</option>
        <option value="switch_scene">Переключить на сцену</option>
        <option value="scene_filter_action">Фильтры сцены</option>
        <option value="source_action">Источники сцены</option>
      </select>
    </div>
    <div id="step3_${index}" style="margin-top: 4px;"></div>
  `;
  document.getElementById(`action_select_${index}`).onchange = (e) => handleActionChange(index, sceneName, e.target.value);
}

async function handleActionChange(index, sceneName, action) {
  const step3 = document.getElementById(`step3_${index}`);
  if (!action) return step3.innerHTML = '';

  if (action === 'switch_scene') {
    step3.innerHTML = `<p>Действие: переключение на сцену <strong>${sceneName}</strong></p>`;
  } else if (action === 'scene_filter_action') {
    const res = await window.pywebview.api.get_filters(sceneName);
    if (res.status !== "ok" || res.filters.length === 0) {
      step3.innerHTML = `<div>Фильтры сцены не найдены</div>`;
      return;
    }
    renderFilterSelection(index, res.filters, `step3_${index}`, "scene");
  } else if (action === 'source_action') {
    const res = await window.pywebview.api.get_scene_sources(sceneName);
    if (res.status !== "ok" || res.sources.length === 0) {
      step3.innerHTML = `<div>Ошибка загрузки источников сцены</div>`;
      return;
    }
    renderSourceSelection(index, res.sources);
  }
}

function renderFilterSelection(index, filters, containerId, context) {
  const container = document.getElementById(containerId);
  container.innerHTML = `
    <div style="display:flex; align-items:center; gap:8px;">
      <label style="width: 60%;">Выберите фильтр:</label>
      <select id="filter_select_${index}">
        <option value="">-- выберите фильтр --</option>
        ${filters.map(f => `<option value="${f}">${f}</option>`).join('')}
      </select>
    </div>
    <div id="step6_${index}" style="margin-top: 4px;"></div>
  `;
  document.getElementById(`filter_select_${index}`).onchange = function () {
    const filter = this.value;
    const step4 = document.getElementById(`step6_${index}`);
    if (!filter) return step4.innerHTML = '';

    step4.innerHTML = `
      <div style="display:flex; align-items:center; gap:8px;">
        <label style="width: 60%;">Действие с фильтром <strong>${filter}</strong>:</label>
        <select id="filter_action_select_${index}">
          <option value="enable">Включить</option>
          <option value="disable">Выключить</option>
        </select>
      </div>
    `;
  };
}

function renderSourceActionSelection(index, source, hasVolume) {
  const step4 = document.getElementById(`step4_${index}`);

  step4.innerHTML = `
    <div style="display:flex; align-items:center; gap:8px;">
      <label style="width: 60%;">Действие с источником <strong>${source}</strong>:</label>
      <select id="source_action_select_${index}">
        <option value="">-- выберите действие --</option>
        <option value="show_hide_source">Показать / Скрыть</option>
        <option value="filter_action">Фильтры источника</option>
        ${hasVolume ? `<option value="volume_control">Изменить громкость</option>` : ''}
      </select>
    </div>
    <div id="step5_${index}" style="margin-top: 4px;"></div>
  `;
  document.getElementById(`source_action_select_${index}`).onchange = (e) =>
    handleSourceAction(index, source, e.target.value);
}

async function renderSourceSelection(index, sources) {
  const step3 = document.getElementById(`step3_${index}`);
  const sourcesWithVolume = {};
  for (const s of sources) {
    try {
      const res = await window.pywebview.api.get_vol(s);
      sourcesWithVolume[s] = res && typeof res.volume === "number";
    } catch (e) {
      sourcesWithVolume[s] = false;
    }
  }
  step3.innerHTML = `
    <div style="display:flex; align-items:center; gap:8px;">
      <label style="width: 60%;">Выберите источник:</label>
      <select id="source_select_${index}">
        <option value="">-- выберите источник --</option>
        ${sources.map(s => `<option value="${s}">${s}</option>`).join('')}
      </select>
    </div>
    <div id="step4_${index}" style="margin-top: 4px;"></div>
  `;
  document.getElementById(`source_select_${index}`).onchange = (e) => {
    const selectedSource = e.target.value;
    if (!selectedSource) return;
    const hasVolume = sourcesWithVolume[selectedSource];
    renderSourceActionSelection(index, selectedSource, hasVolume);
  };
}

function handleSourceChange(index, source) {
  const step4 = document.getElementById(`step4_${index}`);
  if (!source) return step4.innerHTML = '';

  step4.innerHTML = `
    <div style="display:flex; align-items:center; gap:8px;">
      <label style="width: 60%;">Действие с источником <strong>${source}</strong>:</label>
      <select id="source_action_select_${index}">
        <option value="">-- выберите действие --</option>
        <option value="show_hide_source">Показать / Скрыть</option>
        <option value="filter_action">Фильтры источника</option>
        <option value="volume_control">Изменить громкость</option>
      </select>
    </div>
    <div id="step5_${index}" style="margin-top: 4px;"></div>
  `;
  document.getElementById(`source_action_select_${index}`).onchange = (e) =>
    handleSourceAction(index, source, e.target.value);
}

const lastVolumesSent = {};
async function handleSourceAction(index, source, action) {
  const step5 = document.getElementById(`step5_${index}`);
  step5.innerHTML = ''; // очищаем всё при смене действия

  if (!action) return;

  if (action === 'show_hide_source') {
    step5.innerHTML = `
      <div style="display:flex; align-items:center; gap:8px;">
        <label style="width: 60%;">Видимость:</label>
        <select id="visibility_select_${index}">
          <option value="true">Показать</option>
          <option value="false">Скрыть</option>
        </select>
      </div>
    `;

  } else if (action === 'filter_action') {
    const res = await window.pywebview.api.get_filters(source);
    if (res.status !== "ok" || res.filters.length === 0) {
      step5.innerHTML = `<div>Фильтры не найдены</div>`;
      return;
    }
    renderFilterSelection(index, res.filters, `step5_${index}`, "source");

  } else if (action === 'volume_control') {
    const volRes = await window.pywebview.api.get_vol(source);
    if (!volRes || typeof volRes.volume !== "number") {
      step5.innerHTML = `<div>⚠️ У этого источника нет управления громкостью</div>`;
      return;
    }
    const currentVolume = volRes.volume;

    step5.innerHTML = `
      <div style="display:flex; align-items:center; gap:8px; align-items:center;">
        <label style="width: 60%;">Громкость источника:</label>
        <input type="range" min="0" max="100" step="1" value="${currentVolume}" id="volume_slider_${index}">
        <span id="volume_value_${index}">${currentVolume}%</span>
      </div>
    `;

    const slider = document.getElementById(`volume_slider_${index}`);
    const label = document.getElementById(`volume_value_${index}`);

    slider.oninput = () => {
      label.textContent = `${slider.value}%`;
    };
  }
}








async function onSceneSelected(index) {
    const sceneName = document.getElementById(`scene_${index}`).value;
    const res = await window.pywebview.api.get_scene_sources(sceneName);
    const container = document.getElementById(`scene_sources_${index}`);
    if (res.status !== "ok") {
        container.innerHTML = `<div>Не удалось загрузить источники</div>`;
        return;
    }
    const options = res.sources.map(s => `<option value="${s}">${s}</option>`).join('');
    container.innerHTML = `
        <label>Источник:</label>
        <select id="source_${index}" onchange="onSourceSelected(${index})">
            <option value="">-- выберите источник --</option>
            ${options}
        </select>
        <div id="source_filters_${index}"></div>
    `;
}
async function onSourceSelected(index) {
    const sourceName = document.getElementById(`source_${index}`).value;
    if (!sourceName) return;
    const res = await window.pywebview.api.get_filters(sourceName);
    const container = document.getElementById(`source_filters_${index}`);
    if (res.status !== "ok" || res.filters.length === 0) {
        container.innerHTML = `<div>Нет фильтров или ошибка</div>`;
        return;
    }
    const options = res.filters.map(f => `<option value="${f}">${f}</option>`).join('');
    container.innerHTML = `
        <label>Фильтр:</label>
        <select id="filter_${index}">${options}</select>
        <br>
        <button onclick="addFilterToggle(${index}, '${sourceName}', true)">✅ Включить</button>
        <button onclick="addFilterToggle(${index}, '${sourceName}', false)">🚫 Выключить</button>
    `;
}
async function loadFilters(index) {
    const source = document.getElementById(`filter_source_${index}`).value;
    const res = await window.pywebview.api.get_filters(source);
    if (res.status === "ok") {
        const filterSelect = document.getElementById(`filter_filter_${index}`);
        filterSelect.innerHTML = res.filters.map(f => `<option value="${f}">${f}</option>`).join('');
    }
}












// Кнопка включения озвучки
document.addEventListener("DOMContentLoaded", () => {
  if (window.pywebview) {
    pywebview.api.get_tts_enabled().then(enabled => {
      document.getElementById("ttsToggleSwitch").checked = enabled;
    });
  }
});
function onTtsToggle(enabled) {
  if (window.pywebview) {
    pywebview.api.set_tts_enabled(enabled);
  }
}
function updateTtsToggle(enabled) {
  const checkbox = document.getElementById("ttsToggleSwitch");
  checkbox.checked = enabled;
}


// Кнопка включения оверлея
document.addEventListener("DOMContentLoaded", () => {
  console.log("DEBUG: DOMContentLoaded");
  if (!window.pywebview) {
    console.log("DEBUG: pywebview не найден");
    return;
  }

  ['overlay', 'overlay2', 'overlay3'].forEach(name => {
    pywebview.api.get_overlay_enabled(name).then(enabled => {
      console.log(`DEBUG: состояние ${name}: ${enabled}`);
      const el = document.getElementById(name + "Toggle");
      if (el) {
        el.checked = enabled;
        if (enabled) {
          console.log(`DEBUG: запускаем ${name} из JS`);
          window.pywebview.api[`start_${name}`]()
            .then(res => console.log(`${name} started on load:`, res))
            .catch(e => console.error(e));
        }
      }
    });
  });
});

function toggleOverlay(name, enabled) {
  if (!window.pywebview) return;
  window.pywebview.api.set_overlay_enabled(name, enabled)
    .then(() => {
      // Запускаем или останавливаем оверлей по новому состоянию
      if (enabled) {
        window.pywebview.api[`start_${name}`]()
          .then(res => console.log(`${name} started on toggle:`, res))
          .catch(e => console.error(e));
      } else {
        window.pywebview.api[`stop_${name}`]()
          .then(res => console.log(`${name} stopped on toggle:`, res))
          .catch(e => console.error(e));
      }
    })
    .catch(err => console.error("set_overlay_enabled error:", err));
}

function updateOverlayToggle(name, enabled) {
  const idMap = {
    overlay: "overlayToggle",
    overlay2: "overlay2Toggle",
    overlay3: "overlay3Toggle"
  };
  const el = document.getElementById(idMap[name]);
  if (el) el.checked = enabled;

  // Запускаем или останавливаем оверлей согласно состоянию
  if (window.pywebview) {
    if (enabled) {
      window.pywebview.api[`start_${name}`]()
        .then(resp => console.log(`${name} started:`, resp))
        .catch(err => console.error(err));
    } else {
      window.pywebview.api[`stop_${name}`]()
        .then(resp => console.log(`${name} stopped:`, resp))
        .catch(err => console.error(err));
    }
  }
}



//автоматическое добавление из плейлиста
const select = document.getElementById("selectPlatform");
const icon = document.getElementById("platformIcon");

select.addEventListener("change", () => {
  const value = select.value;
  if (value === "vk") icon.src = "svg/vk.png";
  else if (value === "twitch") icon.src = "svg/Twitch.png";
});


// Элементы управления
const rolesList = document.getElementById("rolesList");
const btnAddRole = document.getElementById("btnAddRole");
const modalAddRole = document.getElementById("modalAddRole");
const inputRoleName = document.getElementById("inputRoleName");
const confirmAddRole = document.getElementById("configAddRole");
const cancelAddRole = document.getElementById("cancelAddRole");
const selectPlatform = document.getElementById("selectPlatform");

// Инициализация пустой структуры
let roles_by_platform = {
  vk: [],
  twitch: []
};

const iconOptions = [
  "001.png",
  "002.png",
  "003.png",
  "004.png",
  "005.png",
  "006.png",
  "007.png",
  "008.png",
  "009.png"
];

function updateRolesUI() {
  rolesList.innerHTML = "";
  const orderedPlatforms = ["vk", "twitch"];
  let globalIndex = 0;

  for (const platform of orderedPlatforms) {
    let users = roles_by_platform[platform] || [];

    users = users.map(u => {
      if (typeof u === "string") return { nick: u, icon: "001.png" };
      if (typeof u === "object" && u.nick) return u;
      return null;
    }).filter(Boolean);

    users = [...users].sort((a, b) => a.nick.localeCompare(b.nick));
    users.forEach(user => {
      const li = document.createElement("li");
      li.style.display = "flex";
      li.style.justifyContent = "space-between";
      li.style.alignItems = "center";
      li.style.padding = "0px 4px";
      li.style.margin = "2px 1px";
      li.style.fontWeight = "600";
      li.style.backgroundColor = globalIndex % 2 === 0 ? "rgba(40, 40, 40, 0.8)" : "transparent";
      const spanNick = document.createElement("span");
      const platformIcon = platform === "vk" ? "vk.png" : "twitch.png";
      spanNick.innerHTML = `
        <img src="svg/${platformIcon}" style="width: 24px; vertical-align: middle;  margin-top: -5px;">
        ${user.nick}
      `;

//<img src="moder/${user.icon || "001.png"}" style="width: 20px; vertical-align: middle; margin-right: 6px;">

      const rightContainer = document.createElement("div");
      rightContainer.style.display = "flex";
      rightContainer.style.alignItems = "center";
      const iconDropdown = createIconDropdown(user.icon || "001.png", (newIcon) => {
        const updatedUsers = roles_by_platform[platform].map(u =>
          u.nick === user.nick ? { ...u, icon: newIcon } : u
        );
        roles_by_platform = {
          ...roles_by_platform,
          [platform]: updatedUsers
        };
        saveRolesToConfig()
          .then(response => {
            if (response.status === "ok") {
              updateRolesUI();
              console.log("Роли успешно сохранены и обновлены");
            } else {
              console.error("Ошибка сохранения ролей:", response.message);
            }
          })
          .catch(err => console.error("Ошибка при сохранении ролей:", err));
      });
      iconDropdown.style.marginRight = "12px";
      const btnDel = document.createElement("button");
      btnDel.textContent = "Удалить";
      btnDel.style.fontWeight = "bold";
      btnDel.className = "btn-danger btn-sm";
      btnDel.onclick = () => {
        showDeleteModal(user.nick, platform);
      };

      rightContainer.appendChild(iconDropdown);
      rightContainer.appendChild(btnDel);
      li.appendChild(spanNick);
      li.appendChild(rightContainer);
      rolesList.appendChild(li);

      globalIndex++;
    });
  }
}

// Возвращаем Promise для корректной работы then/catch
function saveRolesToConfig() {
  return window.pywebview.api.set_roles_by_platform(roles_by_platform);
}

// Добавление новой роли
btnAddRole.onclick = () => {
  inputRoleName.value = "";
  modalAddRole.style.display = "flex";
};

confirmAddRole.onclick = () => {
  const nick = inputRoleName.value.trim();
  const platform = selectPlatform.value;
  if (nick && !roles_by_platform[platform]?.some(u => u.nick === nick)) {
    if (!roles_by_platform[platform]) roles_by_platform[platform] = [];
    // Создаём новый массив с добавленной ролью
    roles_by_platform = {
      ...roles_by_platform,
      [platform]: [...roles_by_platform[platform], { nick, icon: "001.png" }]
    };
    updateRolesUI(roles_by_platform);
    saveRolesToConfig()
      .then(response => {
        if (response.status === "ok") {
          console.log("Роль добавлена и сохранена");
        } else {
          console.error("Ошибка сохранения ролей:", response.message);
        }
      })
      .catch(err => console.error("Ошибка при сохранении ролей:", err));
  }
  modalAddRole.style.display = "none";
};

cancelAddRole.onclick = () => {
  modalAddRole.style.display = "none";
};

function createIconDropdown(currentIcon, onChange) {
  const container = document.createElement("div");
  container.style.position = "relative";
  container.style.width = "90px";

  const selected = document.createElement("div");
  selected.style.display = "flex";
  selected.style.alignItems = "center";
  selected.style.cursor = "pointer";
  selected.style.backgroundColor = "#333";
  selected.style.padding = "2px 6px";
  selected.style.borderRadius = "4px";
  selected.style.color = "white";
  selected.style.userSelect = "none";
  selected.style.width = "60px";

  const imgSelected = document.createElement("img");
  imgSelected.src = `svg/${currentIcon}`;
  imgSelected.style.width = "20px";
  imgSelected.style.marginRight = "6px";
  selected.appendChild(imgSelected);

  const arrow = document.createElement("span");
  arrow.textContent = "▼";
  arrow.style.fontSize = "10px";
  arrow.style.marginLeft = "auto";
  selected.appendChild(arrow);

  container.appendChild(selected);

  const dropdown = document.createElement("div");
  dropdown.style.position = "absolute";
  dropdown.style.top = "100%";
  dropdown.style.left = "0";
  dropdown.style.backgroundColor = "#222";
  dropdown.style.border = "1px solid #555";
  dropdown.style.borderRadius = "4px";
  dropdown.style.marginTop = "2px";
  dropdown.style.zIndex = "1000";
  dropdown.style.display = "none";
  dropdown.style.maxHeight = "150px";
  dropdown.style.overflowY = "auto";

  iconOptions.forEach(icon => {
    const option = document.createElement("div");
    option.style.padding = "4px 6px";
    option.style.display = "flex";
    option.style.alignItems = "center";
    option.style.cursor = "pointer";
    option.style.color = "white";

    const img = document.createElement("img");
    img.src = `svg/${icon}`;
    img.style.width = "20px";
    img.style.marginRight = "6px";
    option.appendChild(img);

    option.onmouseenter = () => option.style.backgroundColor = "#444";
    option.onmouseleave = () => option.style.backgroundColor = "transparent";

    option.onclick = () => {
      imgSelected.src = `svg/${icon}`;
      dropdown.style.display = "none";

      setTimeout(() => {
        onChange(icon);
      }, 0);
    };

    dropdown.appendChild(option);
  });

  container.appendChild(dropdown);

  selected.onclick = () => {
    dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
  };

  // Закрывать дропдаун при клике вне
  document.addEventListener("click", e => {
    if (!container.contains(e.target)) {
      dropdown.style.display = "none";
    }
  });

  return container;
}

// Модалка подтверждения удаления
const modalConfirmDelete = document.getElementById("modalConfirmDelete");
const deleteMessage = document.getElementById("deleteMessage");
const confirmDeleteBtn = document.getElementById("confirmDelete");
const cancelDeleteBtn = document.getElementById("cancelDelete");

let pendingDelete = { nick: "", platform: "" };

function showDeleteModal(nick, platform) {
  pendingDelete.nick = nick;
  pendingDelete.platform = platform;
  deleteMessage.textContent = `Удалить ${nick} с платформы ${platform}?`;
  modalConfirmDelete.style.display = "flex";
}

confirmDeleteBtn.onclick = () => {
  const { nick, platform } = pendingDelete;
  roles_by_platform[platform] = roles_by_platform[platform].filter(u => u.nick !== nick);
  updateRolesUI(roles_by_platform);
  saveRolesToConfig();
  modalConfirmDelete.style.display = "none";
};

cancelDeleteBtn.onclick = () => {
  modalConfirmDelete.style.display = "none";
};

// Загрузка данных при старте
function waitForPywebviewApi(callback) {
    if (window.pywebview && window.pywebview.api && window.pywebview.api.get_roles_by_platform) {
        console.log("🚀 pywebview API найден");
        callback();
    } else {
        console.log("⏳ Ожидание pywebview.api...");
        setTimeout(() => waitForPywebviewApi(callback), 100);
    }
}

waitForPywebviewApi(() => {
    window.pywebview.api.get_roles_by_platform()
    .then(data => {
        console.log("🔧 Полученные роли из Python:", data);
        if (data && typeof data === 'object') {
            roles_by_platform = data;
            updateRolesUI(roles_by_platform);
        } else {
            console.error("❌ Некорректные данные из Python:", data);
        }
    }).catch(err => {
        console.error("❌ Ошибка при получении ролей:", err);
    });
});




//Настройки озвучки сообщений
function updateTtsRateSlider(rate) {
    const slider = document.getElementById("ttsRateSlider");
    const label = document.getElementById("ttsRateLabel");

    slider.value = rate;
    label.innerText = rate;
}
document.getElementById("ttsRateSlider").addEventListener("input", function(e) {
    const rate = parseInt(e.target.value);
    document.getElementById("ttsRateLabel").innerText = rate;
    if (window.pywebview) {
        pywebview.api.set_tts_rate(rate);
    }
});

document.addEventListener("DOMContentLoaded", () => {
  if (window.pywebview) {
    pywebview.api.get_tts_settings().then(settings => {
      updateTtsVolumeSlider(settings.tts_volume);
      updateVoiceSelect(settings.tts_voice);
      updateTtsRateSlider(settings.tts_rate);
    });
  }
    const toggles = document.querySelectorAll("h2.toggle");
    toggles.forEach(toggle => {
      toggle.addEventListener("click", () => {
        const next = toggle.nextElementSibling;
        next.classList.toggle("open");
      });
    });
});
function updateTtsVolumeSlider(volume) {
    const slider = document.getElementById("ttsVolumeSlider");
    const label = document.getElementById("ttsVolumeLabel");

    slider.value = volume * 100;
    label.innerText = Math.round(volume * 100);
}
function updateVoiceSelect(voice) {
    const select = document.getElementById("voiceSelect");
    select.value = voice;
}
document.getElementById("ttsVolumeSlider").addEventListener("input", function(e) {
    const vol = parseInt(e.target.value);
    document.getElementById("ttsVolumeLabel").innerText = vol;
    if (window.pywebview) {
        pywebview.api.set_tts_volume(vol / 100);
    }
});
document.getElementById("voiceSelect").addEventListener("change", function(e) {
    if (window.pywebview) {
        pywebview.api.set_tts_voice(e.target.value);
    }
});
function testTts() {
    if (window.pywebview) {
        pywebview.api.say("Тест озвучки сообщения");
    }
}





function showAddToPlaylistModal() {
  document.getElementById("addToPlaylistModal").classList.add("active");
}
function hideAddToPlaylistModal() {
  document.getElementById("addToPlaylistModal").classList.remove("active");
}
document.getElementById("btnCancelAddToPlaylist").onclick = hideAddToPlaylistModal;


function selectStyle(styleId) {
  // Сразу применяем стиль локально, чтобы не ждать pywebview
  applyStyle(styleId);
  // Вызываем запись стиля (оставляем как есть)
  window.pywebview.api.setStyle(styleId);
  // Обновляем UI выделение
  document.querySelectorAll('.style-box').forEach(el => el.classList.remove('selected'));
  const selectedBox = document.querySelector(`.style-box[data-style="${styleId}"]`);
  if (selectedBox) selectedBox.classList.add('selected');
}


  // Обновить интерфейс по стилю (например, фон)
function applyStyle(styleId) {
  const root = document.documentElement;

  if (styleId === 1) {
    root.style.setProperty('--primary-color', '#d9a000');
    root.style.setProperty('--primary-color-translucent', '#d9a00082');
    root.style.setProperty('--primary-text', '#000');
    root.style.setProperty('--btn-primary-bg-color', '#ffbc00');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #ffa700, #7e5c00, #ffa100)');
    root.style.setProperty('--btn-primary-text-color', '#000');
    root.style.setProperty('--btn-primary-hover-bg-color', '#d9a000');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #ffbc00, #d9a000, #ffbc00)');
    root.style.setProperty('--btn-primary-hover-text-color', '#000');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #ffad12, #bd8a00, #ffa915)');
    root.style.setProperty('--btn-16-after-background', '#e2a700');
    root.style.setProperty('--range-start-color', '#886300');
    root.style.setProperty('--range-end-color', '#ffbc00');
    root.style.setProperty('--favorites-scrollbar-thumb', '#ff9900');
    root.style.setProperty('--favorites-scrollbar-track', '#2b2b2b');
    root.style.setProperty('--favorite-item-hover-color', '#e0c146');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(255, 165, 0, 0.5)');
    root.style.setProperty('--on-hue1', '45');
    root.style.setProperty('--on-hue2', '55');

  } else if (styleId === 2) {
    root.style.setProperty('--primary-color', '#ae7cf7');
    root.style.setProperty('--primary-color-translucent', '#873ff080');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#8b48ee');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #8d46f5, #7121e4, #8b48ee)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#7121e4');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #7a39d1, #ae7cf7, #7a39d1)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #8d46f5, #7121e4, #8b48ee)');
    root.style.setProperty('--btn-16-after-background', '#7a39d1');
    root.style.setProperty('--range-start-color', '#6f3ed1');
    root.style.setProperty('--range-end-color', '#a17ff7');
    root.style.setProperty('--favorites-scrollbar-thumb', '#ae7cf7');
    root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
    root.style.setProperty('--favorite-item-hover-color', '#b6a8f7');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(150, 79, 253, 0.5)');
    root.style.setProperty('--on-hue1', '270');
    root.style.setProperty('--on-hue2', '280');

  } else if (styleId === 3) {
    root.style.setProperty('--primary-color', '#5181b8');
    root.style.setProperty('--primary-color-translucent', '#5181b880');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#5181b8');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #37598a, #5181b8)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#3e6499');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #37598a, #3e6499, #37598a)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #37598a, #5181b8)');
    root.style.setProperty('--btn-16-after-background', '#3e6499');
    root.style.setProperty('--range-start-color', '#37598a');
    root.style.setProperty('--range-end-color', '#6a8cc9');
    root.style.setProperty('--favorites-scrollbar-thumb', '#5181b8');
    root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
    root.style.setProperty('--favorite-item-hover-color', '#7a94c3');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(81, 129, 184, 0.5)');
    root.style.setProperty('--on-hue1', '210');
    root.style.setProperty('--on-hue2', '220');

  } else if (styleId === 4) {
    root.style.setProperty('--primary-color', '#00bfa5');
    root.style.setProperty('--primary-color-translucent', '#00bfa580');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#00c8b3');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #00d3b8, #00796b)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#009e89');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #00bfa5, #00796b)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #00796b, #00d3b8)');
    root.style.setProperty('--btn-16-after-background', '#009e89');
    root.style.setProperty('--range-start-color', '#00897b');
    root.style.setProperty('--range-end-color', '#00d8c4');
    root.style.setProperty('--favorites-scrollbar-thumb', '#00bfa5');
    root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
    root.style.setProperty('--favorite-item-hover-color', '#33e6cf');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(0, 191, 165, 0.4)');
    root.style.setProperty('--on-hue1', '170');
    root.style.setProperty('--on-hue2', '180');

  } else if (styleId === 5) {
    root.style.setProperty('--primary-color', '#ff6f61');
    root.style.setProperty('--primary-color-translucent', '#ff6f6180');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#ff7a70');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #ff8c7a, #e64c3c)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#e64c3c');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #ff6f61, #b03a2e)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #ff857c, #ff6f61)');
    root.style.setProperty('--btn-16-after-background', '#d1443a');
    root.style.setProperty('--range-start-color', '#c43e35');
    root.style.setProperty('--range-end-color', '#ff9990');
    root.style.setProperty('--favorites-scrollbar-thumb', '#ff6f61');
    root.style.setProperty('--favorites-scrollbar-track', '#2b2b2b');
    root.style.setProperty('--favorite-item-hover-color', '#ffb2a9');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(255, 111, 97, 0.4)');
    root.style.setProperty('--on-hue1', '10');
    root.style.setProperty('--on-hue2', '20');
	
} else if (styleId === 6) {
  // 🌊 Глубокая лагуна (между 3 и 4 стилем)
  root.style.setProperty('--primary-color', '#2196f3'); // лазурный (чуть ярче, ближе к морской синеве)
  root.style.setProperty('--primary-color-translucent', '#2196f380');
  root.style.setProperty('--primary-text', '#ffffff'); // отлично читается
  root.style.setProperty('--btn-primary-bg-color', '#1cb0f6');
  root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #00c4ff, #0077c2)');
  root.style.setProperty('--btn-primary-text-color', '#ffffff');
  root.style.setProperty('--btn-primary-hover-bg-color', '#008dd1');
  root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #00e0ff, #005eaa)');
  root.style.setProperty('--btn-primary-hover-text-color', '#ffffff');
  root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #00c4ff, #2196f3)');
  root.style.setProperty('--btn-16-after-background', '#0077c2');
  root.style.setProperty('--range-start-color', '#00bcd4');
  root.style.setProperty('--range-end-color', '#64b5f6');
  root.style.setProperty('--favorites-scrollbar-thumb', '#00b0ff');
  root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
  root.style.setProperty('--favorite-item-hover-color', '#a2d9ff');
  root.style.setProperty('--favorite-item-shadow-color', 'rgba(33, 150, 243, 0.4)');
  root.style.setProperty('--on-hue1', '200');
  root.style.setProperty('--on-hue2', '210');

  } else if (styleId === 7) {
    // 🍃 Лесной стиль
    root.style.setProperty('--primary-color', '#4caf50');
    root.style.setProperty('--primary-color-translucent', '#4caf5080');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#43a047');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #66bb6a, #388e3c)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#388e3c');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #4caf50, #2e7d32)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #43a047, #66bb6a)');
    root.style.setProperty('--btn-16-after-background', '#388e3c');
    root.style.setProperty('--range-start-color', '#2e7d32');
    root.style.setProperty('--range-end-color', '#81c784');
    root.style.setProperty('--favorites-scrollbar-thumb', '#43a047');
    root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
    root.style.setProperty('--favorite-item-hover-color', '#a5d6a7');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(76, 175, 80, 0.4)');
    root.style.setProperty('--on-hue1', '120');
    root.style.setProperty('--on-hue2', '130');

  } else if (styleId === 8) {
    // 🦄 Радужный стиль
    root.style.setProperty('--primary-color', '#e91e63');
    root.style.setProperty('--primary-color-translucent', '#e91e6380');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#ff4081');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #ff4081, #7c4dff, #00bcd4)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#d81b60');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #e91e63, #7c4dff)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #ff4081, #7c4dff)');
    root.style.setProperty('--btn-16-after-background', '#c2185b');
    root.style.setProperty('--range-start-color', '#ff4081');
    root.style.setProperty('--range-end-color', '#7c4dff');
    root.style.setProperty('--favorites-scrollbar-thumb', '#e91e63');
    root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
    root.style.setProperty('--favorite-item-hover-color', '#f8bbd0');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(233, 30, 99, 0.4)');
    root.style.setProperty('--on-hue1', '320');
    root.style.setProperty('--on-hue2', '330');

  } else if (styleId === 9) {
    root.style.setProperty('--primary-color', '#ff7043');
    root.style.setProperty('--primary-color-translucent', '#ff704380');
    root.style.setProperty('--primary-text', '#000');
    root.style.setProperty('--btn-primary-bg-color', '#ff8a65');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #ff7043, #d84315)');
    root.style.setProperty('--btn-primary-text-color', '#000');
    root.style.setProperty('--btn-primary-hover-bg-color', '#f4511e');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #ff8a65, #d84315)');
    root.style.setProperty('--btn-primary-hover-text-color', '#000');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #ff7043, #ff5722)');
    root.style.setProperty('--btn-16-after-background', '#d84315');
    root.style.setProperty('--range-start-color', '#ff7043');
    root.style.setProperty('--range-end-color', '#ffa270');
    root.style.setProperty('--favorites-scrollbar-thumb', '#ff7043');
    root.style.setProperty('--favorites-scrollbar-track', '#2b2b2b');
    root.style.setProperty('--favorite-item-hover-color', '#ffab91');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(255, 112, 67, 0.4)');
    root.style.setProperty('--on-hue1', '18');
    root.style.setProperty('--on-hue2', '25');

  } else if (styleId === 10) {
    root.style.setProperty('--primary-color', '#00796b'); // более тёмный зелёный
    root.style.setProperty('--primary-color-translucent', '#00796b80');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#004d40'); // ещё темнее
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #00796b, #004d40)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#00695c'); // оттенок для ховера
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #004d40, #00695c)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #004d40, #00695c)');
    root.style.setProperty('--btn-16-after-background', '#004d40');
    root.style.setProperty('--range-start-color', '#00695c');
    root.style.setProperty('--range-end-color', '#009688'); // немного светлее в градиенте
    root.style.setProperty('--favorites-scrollbar-thumb', '#00695c');
    root.style.setProperty('--favorites-scrollbar-track', '#121212');
    root.style.setProperty('--favorite-item-hover-color', '#00897b');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(0, 105, 92, 0.4)');
    root.style.setProperty('--on-hue1', '150');
    root.style.setProperty('--on-hue2', '160');

  } else if (styleId === 11) {
    root.style.setProperty('--primary-color', '#3f51b5'); // насыщенный синий
    root.style.setProperty('--primary-color-translucent', '#3f51b580');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#303f9f');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #3f51b5, #283593)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#283593');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #303f9f, #1a237e)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #3f51b5, #303f9f)');
    root.style.setProperty('--btn-16-after-background', '#1a237e');
    root.style.setProperty('--range-start-color', '#283593');
    root.style.setProperty('--range-end-color', '#7986cb');
    root.style.setProperty('--favorites-scrollbar-thumb', '#3f51b5');
    root.style.setProperty('--favorites-scrollbar-track', '#2b2b2b');
    root.style.setProperty('--favorite-item-hover-color', '#9fa8da');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(63, 81, 181, 0.4)');
    root.style.setProperty('--on-hue1', '225');
    root.style.setProperty('--on-hue2', '230');

  } else if (styleId === 12) {
    root.style.setProperty('--primary-color', '#a1887f'); // светлее коричневый
    root.style.setProperty('--primary-color-translucent', '#a1887f80');
    root.style.setProperty('--primary-text', '#000'); // сменил на тёмный текст для контраста
    root.style.setProperty('--btn-primary-bg-color', '#bcaaa4');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #a1887f, #8d6e63)');
    root.style.setProperty('--btn-primary-text-color', '#000');
    root.style.setProperty('--btn-primary-hover-bg-color', '#8d6e63');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #bcaaa4, #6d4c41)');
    root.style.setProperty('--btn-primary-hover-text-color', '#000');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #a1887f, #bcaaa4)');
    root.style.setProperty('--btn-16-after-background', '#6d4c41');
    root.style.setProperty('--range-start-color', '#8d6e63');
    root.style.setProperty('--range-end-color', '#d7ccc8');
    root.style.setProperty('--favorites-scrollbar-thumb', '#a1887f');
    root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
    root.style.setProperty('--favorite-item-hover-color', '#d7ccc8');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(161, 136, 127, 0.4)');
    root.style.setProperty('--on-hue1', '20');
    root.style.setProperty('--on-hue2', '25');

  } else if (styleId === 13) {
    root.style.setProperty('--primary-color', '#607d8b'); // серо-голубой из CSS
    root.style.setProperty('--primary-color-translucent', '#607d8b80');
    root.style.setProperty('--primary-text', '#fff');
    root.style.setProperty('--btn-primary-bg-color', '#546e7a');
    root.style.setProperty('--btn-primary-bg-gradient', 'linear-gradient(to bottom left, #607d8b, #455a64)');
    root.style.setProperty('--btn-primary-text-color', '#fff');
    root.style.setProperty('--btn-primary-hover-bg-color', '#455a64');
    root.style.setProperty('--btn-primary-hover-bg-gradient', 'linear-gradient(to bottom left, #546e7a, #263238)');
    root.style.setProperty('--btn-primary-hover-text-color', '#fff');
    root.style.setProperty('--btn-16-background', 'linear-gradient(to bottom left, #607d8b, #546e7a)');
    root.style.setProperty('--btn-16-after-background', '#263238');
    root.style.setProperty('--range-start-color', '#546e7a');
    root.style.setProperty('--range-end-color', '#90a4ae');
    root.style.setProperty('--favorites-scrollbar-thumb', '#607d8b');
    root.style.setProperty('--favorites-scrollbar-track', '#1a1a1a');
    root.style.setProperty('--favorite-item-hover-color', '#b0bec5');
    root.style.setProperty('--favorite-item-shadow-color', 'rgba(96, 125, 139, 0.4)');
    root.style.setProperty('--on-hue1', '190');
    root.style.setProperty('--on-hue2', '200');
  }
}



// Настройка названий наград
function reward_clip() {
  const val = document.getElementById("reward_clip").value;
  window.pywebview.api.setRewardClip(val);
}
function reward_clip_out() {
  const val = document.getElementById("reward_clip_out").value;
  window.pywebview.api.setRewardClipOut(val);
}
function updateRewardClip(val) {
  document.getElementById("reward_clip").value = val;
}
function updateRewardClipOut(val) {
  document.getElementById("reward_clip_out").value = val;
}


function reward_science() {
  const val = document.getElementById("reward_science").value;
  window.pywebview.api.setRewardScience(val);
}
function updateRewardScience(val) {
  document.getElementById("reward_science").value = val;
}
function reward_history() {
  const val = document.getElementById("reward_history").value;
  window.pywebview.api.setRewardHistory(val);
}
function updateRewardHistory(val) {
  document.getElementById("reward_history").value = val;
}


function reward_fact() {
  const val = document.getElementById("reward_fact").value;
  window.pywebview.api.setRewardFact(val);
}
function updateRewardFact(val) {
  document.getElementById("reward_fact").value = val;
}

function reward_joke() {
  const val = document.getElementById("reward_joke").value;
  window.pywebview.api.setRewardJoke(val);
}
function updateRewardJoke(val) {
  document.getElementById("reward_joke").value = val;
}

function reward_aphorism() {
  const val = document.getElementById("reward_aphorism").value;
  window.pywebview.api.setRewardAphorism(val);
}
function updateRewardAphorism(val) {
  document.getElementById("reward_aphorism").value = val;
}

function window1_width() {
  const val = document.getElementById("window1_width").value;
  window.pywebview.api.setWindow1_Width(val);
}
function updateWindow1_Width(val) {
  document.getElementById("window1_width").value = val;
}
function window1_height() {
  const val = document.getElementById("window1_height").value;
  window.pywebview.api.setWindow1_Height(val);
}
function updateWindow1_Height(val) {
  document.getElementById("window1_height").value = val;
}
function window2_width() {
  const val = document.getElementById("window2_width").value;
  window.pywebview.api.setWindow2_Width(val);
}
function updateWindow2_Width(val) {
  document.getElementById("window2_width").value = val;
}
function window2_height() {
  const val = document.getElementById("window2_height").value;
  window.pywebview.api.setWindow2_Height(val);
}
function updateWindow2_Height(val) {
  document.getElementById("window2_height").value = val;
}


// Спам фильтр
function updateSpamThresholds() {
  try {
    const thresholds = {
      char_repeat_threshold: parseInt(document.getElementById("char_repeat_threshold").value) || 3,
      word_repeat_sequence_length: parseInt(document.getElementById("word_repeat_sequence_length").value) || 4,
      phrase_repeat_threshold: parseInt(document.getElementById("phrase_repeat_threshold").value) || 3,
      special_char_repeat_threshold: parseInt(document.getElementById("special_char_repeat_threshold").value) || 4,
      max_emojis_total: parseInt(document.getElementById("max_emojis_total").value) || 4,
      emoji_repeat_threshold: parseInt(document.getElementById("emoji_repeat_threshold").value) || 4,
    };
    window.pywebview.api.setSpamThresholds(thresholds);
  } catch (err) {
    console.error("Ошибка при отправке параметров в Python:", err);
  }
}

function updateSpamSettings(thresholds) {
  try {
    document.getElementById("char_repeat_threshold").value = thresholds.char_repeat_threshold;
    document.getElementById("word_repeat_sequence_length").value = thresholds.word_repeat_sequence_length;
    document.getElementById("phrase_repeat_threshold").value = thresholds.phrase_repeat_threshold;
    document.getElementById("special_char_repeat_threshold").value = thresholds.special_char_repeat_threshold;
    document.getElementById("max_emojis_total").value = thresholds.max_emojis_total;
    document.getElementById("emoji_repeat_threshold").value = thresholds.emoji_repeat_threshold;
  } catch (e) {
    console.error("Ошибка при установке значений из Python:", e);
  }
}


// Настройка озвучки
function reward_voice() {
  const val = document.getElementById("reward_voice").value;
  window.pywebview.api.setRewardVoice(val);
}
function updateRewardVoice(val) {
  document.getElementById("reward_voice").value = val;
}

function tts_text() {
  const val = document.getElementById("tts_text").value;
  window.pywebview.api.setTtsText(val);
}
function tts_scream() {
  const val = document.getElementById("tts_scream").value;
  window.pywebview.api.setTtsScream(val);
}
function tts_text_raid() {
  const val = document.getElementById("tts_text_raid").value;
  window.pywebview.api.setTtsTextRaid(val);
}
function site_text() {
  const val = document.getElementById("site_text").value;
  window.pywebview.api.setSiteText(val);
}
function welcome_portal() {
  const val = document.getElementById("welcome_portal").value;
  window.pywebview.api.setWelcomePortal(val);
}
function updateTtsText(val) {
  document.getElementById("tts_text").value = val;
}
function updateTtsScream(val) {
  document.getElementById("tts_scream").value = val;
}
function updateTtsTextRaid(val) {
  document.getElementById("tts_text_raid").value = val;
}
function updateSiteText(val) {
  document.getElementById("site_text").value = val;
}
function updateWelcomePortal(val) {
  document.getElementById("welcome_portal").value = val;
}

function onCollectViewersChange() {
  const val = document.getElementById("collect_viewers").checked ? 1 : 0;
  window.pywebview.api.setCollectViewers(val);
}
function onTtsClipChange() {
  const val = document.getElementById("tts_clip").checked ? 1 : 0;
  window.pywebview.api.setTtsClip(val);
}
function onStatSenderChange() {
  const val = document.getElementById("stat_sender").checked ? 1 : 0;
  window.pywebview.api.setStatSender(val);
}
function onChatTimeChange() {
  const val = document.getElementById("chat_time").checked ? 1 : 0;
  window.pywebview.api.setChatTime(val);
}

function updateCollectViewers(val) {
  document.getElementById("collect_viewers").checked = val == 1;
}
function updateTtsClip(val) {
  document.getElementById("tts_clip").checked = val == 1;
}
function updateStatSender(val) {
  document.getElementById("stat_sender").checked = val == 1;
}
function updateChatTime(val) {
  document.getElementById("chat_time").checked = val == 1;
}

function onChatFrameChange() {
  const val = document.getElementById("chat_frame").checked ? 1 : 0;
  window.pywebview.api.setChatFrame(val);
}
function updateChatFrame(val) {
  document.getElementById("chat_frame").checked = val == 1;
}

function onChatFramenChange() {
  const val = document.getElementById("chat_framen").checked ? 1 : 0;
  window.pywebview.api.setChatFramen(val);
}
function updateChatFramen(val) {
  document.getElementById("chat_framen").checked = val == 1;
}

function onSkipRepeatedSenderChange() {
  const val = document.getElementById("skip_repeated_sender").checked ? 1 : 0;
  window.pywebview.api.setSkipRepeatedSender(val);
}
function updateSkipRepeatedSender(val) {
  document.getElementById("skip_repeated_sender").checked = val == 1;
}

function obs_video() {
  const val = document.getElementById("obs_video").value;
  window.pywebview.api.setObsVideo(val);
}
function updateObsVideo(val) {
  document.getElementById("obs_video").value = val;
}
function obs_target() {
  const val = document.getElementById("obs_target").value;
  window.pywebview.api.setObsTarget(val);
}
function updateObsTarget(val) {
  document.getElementById("obs_target").value = val;
}


function onTtsToggle(enabled) {
  window.pywebview.api.set_tts_enabled(enabled);
}

  function autoSaveObsConfig() {
    const host = document.getElementById('obs-host').value;
    const port = document.getElementById('obs-port').value;
    const password = document.getElementById('obs-password').value;
    window.pywebview.api.set_obs_config(host, port, password)
      .then(response => console.log("[OK] OBS config saved"))
      .catch(err => console.error("[ERR] Saving OBS config:", err));
  }

  function loadObsConfig() {
    window.pywebview.api.get_obs_config()
      .then(config => {
        document.getElementById('obs-host').value = config.host || "";
        document.getElementById('obs-port').value = config.port || "";
        document.getElementById('obs-password').value = config.password || "";
      })
      .catch(err => console.error("[ERR] Loading OBS config:", err));
  }

  function waitForPywebview(callback) {
    if (window.pywebview) {
      callback();
    } else {
      setTimeout(() => waitForPywebview(callback), 100);
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    waitForPywebview(() => {
      loadObsConfig();
      document.getElementById('obs-host').addEventListener('input', autoSaveObsConfig);
      document.getElementById('obs-port').addEventListener('input', autoSaveObsConfig);
      document.getElementById('obs-password').addEventListener('input', autoSaveObsConfig);
    });
  });





  // Bootstrap tab init
  document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
    tab.addEventListener('click', e => {
      e.preventDefault();
      document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      tab.classList.add('active');
      document.querySelector(tab.getAttribute('href')).classList.add('active');
    });
  });


function onChatSizeChange() {
  const color = document.getElementById("chatBgColor").value;
  const alpha = parseFloat(document.getElementById("chatBgAlpha").value);
  const r = parseInt(color.substr(1, 2), 16);
  const g = parseInt(color.substr(3, 2), 16);
  const b = parseInt(color.substr(5, 2), 16);
  const rgba = `rgba(${r},${g},${b},${alpha})`;

  console.log("[JS] Sending chat size/color:", rgba);
  window.pywebview.api.setChatSize(rgba);
}
function updateChatbgcolor(rgba) {
  const match = rgba.match(/rgba?\((\d+), ?(\d+), ?(\d+), ?([\d.]+)\)/);
  if (match) {
    const r = parseInt(match[1]).toString(16).padStart(2, '0');
    const g = parseInt(match[2]).toString(16).padStart(2, '0');
    const b = parseInt(match[3]).toString(16).padStart(2, '0');
    const a = parseFloat(match[4]);
    document.getElementById('chatBgColor').value = `#${r}${g}${b}`;
    document.getElementById('chatBgAlpha').value = a;
    document.documentElement.style.setProperty('--msg-bg', rgba);
  }
}


function onChatTextColorChange() {
  const color = document.getElementById("chatTextColor").value;
  console.log("[JS] Sending chat text color:", color);
  window.pywebview.api.setChatTextColor(color);
}
function updateChatTextColor(color) {
  document.getElementById("chatTextColor").value = color;
  document.documentElement.style.setProperty('--msg-text-color', color);
}

function onChatTextColorNameChange() {
  const color = document.getElementById("chatTextColorName").value;
  console.log("[JS] Sending chat text color:", color);
  window.pywebview.api.setChatTextColorName(color);
}
function updateChatTextColorName(color) {
  document.getElementById("chatTextColorName").value = color;
}


   // Стиль текста  
    function onChatFontFamilyChange() {
      const selectedFont = document.getElementById("chatFontFamily").value;
      window.pywebview.api.setChatFont(selectedFont); // 💡 вызывает Python
    }
    document.getElementById("chatFontFamily").addEventListener('change', onChatFontFamilyChange);

    function updateChatFontFamily(font) {
      document.getElementById("chatFontFamily").value = font;
    }
    // Запрашиваем текущий шрифт при загрузке
    window.addEventListener("pywebviewready", () => {
      window.pywebview.api.getChatFont().then(data => {
        updateChatFontFamily(data.font);
      });
    });


   // Стиль текста  
  function onChatOverlayChange() {
    const selectedOverlay = document.getElementById("chatOverlay").value;
    console.log(`▶️ Новый overlay: ${selectedOverlay}`);
    window.pywebview.api.setChatOverlay(selectedOverlay).then(response => {
      console.log("Ответ от Python:", response);
    });
  }
  document.getElementById("chatOverlay").addEventListener('change', onChatOverlayChange);
  function updateChatOverlay(overlay) {
    document.getElementById("chatOverlay").value = overlay;
  }
  // Запрашиваем текущий overlay при загрузке
  window.addEventListener("pywebviewready", () => {
    window.pywebview.api.getChatOverlay().then(data => {
      updateChatOverlay(data.overlay);
    });
  });



function onChatTimeoutChange() {
  const timeout = parseInt(document.getElementById("chatTimeout").value, 10);
  window.pywebview.api.setChatTimeout(timeout);
}

function onChatLimitChange() {
  const limit = parseInt(document.getElementById("chatMaxMessages").value, 10);
  window.pywebview.api.setChatLimit(limit);
}

function updateChatOvd(val) {
  document.getElementById("chatOvd").value = val;
}

function updateChatWidthX(val) {
  document.getElementById("chatWidthX").value = val;
}
function updateChatWidthY(val) {
  document.getElementById("chatWidthY").value = val;
}
function updateChatWidthOv(val) {
  document.getElementById("chatWidthOv").value = val;
}

function updateChatHeightOv(val) {
  document.getElementById("chatHeightOv").value = val;
}

function updateChatZoomOv(val) {
  document.getElementById("chatZoomOv").value = val;
}

function toggleInputs2(isChecked) {
  const widthInput2 = document.getElementById('window1_width');
  const heightInput2 = document.getElementById('window1_height');
  const overInput2 = document.getElementById('chatOvd');
  widthInput2.disabled = isChecked;
  heightInput2.disabled = isChecked;
  overInput2.disabled = isChecked;
  widthInput2.style.cursor = isChecked ? 'not-allowed' : 'auto';
  heightInput2.style.cursor = isChecked ? 'not-allowed' : 'auto';
  overInput2.style.cursor = isChecked ? 'not-allowed' : 'auto';
  onChatSizeChangeOv();
}
function toggleInputs3(isChecked) {
  const widthInput3 = document.getElementById('window2_width');
  const heightInput3 = document.getElementById('window2_height');
  const overInput3 = document.getElementById('chatOvd2');
  widthInput3.disabled = isChecked;
  heightInput3.disabled = isChecked;
  overInput3.disabled = isChecked;
  widthInput3.style.cursor = isChecked ? 'not-allowed' : 'auto';
  heightInput3.style.cursor = isChecked ? 'not-allowed' : 'auto';
  overInput3.style.cursor = isChecked ? 'not-allowed' : 'auto';
  onChatSizeChangeOv();
}

function onChatSizeChangeOv() {
  const widthx = document.getElementById("chatWidthX").value;
  const widthy = document.getElementById("chatWidthY").value;
  const width = document.getElementById("chatWidthOv").value;
  const height = document.getElementById("chatHeightOv").value;
  const zoom = document.getElementById("chatZoomOv").value;
  const ovd = document.getElementById("chatOvd").value;
  window.pywebview.api.setChatSizeOv(widthx, widthy, width, height, zoom, ovd); // Функция в backend
}
function onChatSizeChangeOv2() {
  const ovd2 = document.getElementById("chatOvd2").value;
  window.pywebview.api.setChatSizeOv2(ovd2);
}

function updateChatOvd2(val) {
  document.getElementById("chatOvd2").value = val;
}


  let currentVisible = null; // может быть 'log', 'favorites', или null

  function showLog() {
    const log = document.getElementById("logContainer");
    const fav = document.getElementById("favoritesContainer");

    if (currentVisible === 'log') {
      log.style.display = "none";
      currentVisible = null;
    } else {
      log.style.display = "block";
      fav.style.display = "none";
      currentVisible = 'log';
    }
  }

  function showFavorites() {
    const log = document.getElementById("logContainer");
    const fav = document.getElementById("favoritesContainer");

    if (currentVisible === 'favorites') {
      fav.style.display = "none";
      currentVisible = null;
    } else {
      fav.style.display = "block";
      log.style.display = "none";
      currentVisible = 'favorites';
    }
  }



  // Проверка на доступность функции
  console.log('Функция updateMaxVideoLength доступна:', typeof updateMaxVideoLength);
  
  // Определение функции
  function updateMaxVideoLength(minutes) {
    console.log("[DEBUG] updateMaxVideoLength вызвана с:", minutes);
    const inputField = document.getElementById('maxVideoLength');
    inputField.value = minutes; // Обновляем поле ввода
  }
  
  
  
  
function waitForAPI(callback) {
    if (window.pywebview && window.pywebview.api && window.pywebviewReady) {
        callback();
    } else {
        setTimeout(() => waitForAPI(callback), 100);
    }
}

function minimizeWindow() {
    waitForAPI(() => window.pywebview.api.minimize());
}

function closeWindow() {
    waitForAPI(() => window.pywebview.api.close());
}



  window.onload = function () {
    console.log('[JS] Всё загружено. Сообщаем Python.');
    if (window.pywebview && window.pywebview.api && window.pywebview.api.notifyReady) {
      window.pywebview.api.notifyReady();  // вызовет backend
    }
  };
  
div.addEventListener("mouseenter", () => {
  isHovered = true;
  if (!isOverRemoveBtn) {
    div.classList.add("favorite-item-hovered");
  }
});

div.addEventListener("mouseleave", () => {
  isHovered = false;
  div.classList.remove("favorite-item-hovered");
});


</script>
  


  <!-- Скрипты -->
  <script src="black-dashboard/assets/js/core/jquery.min.js"></script>
  <script src="black-dashboard/assets/js/core/popper.min.js"></script>
  <script src="black-dashboard/assets/js/core/bootstrap.min.js"></script>
  <script src="black-dashboard/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <script src="black-dashboard/assets/js/plugins/bootstrap-notify.js"></script>
  <script src="black-dashboard/assets/js/black-dashboard.min.js?v=1.0.0"></script>


  
<style>

.table tbody tr:nth-child(even) {
  background-color: rgba(255, 255, 255, 0.02);
}
#authorsTable tbody tr:nth-child(odd) {
  background-color: rgb(150 150 150 / 6%);
}
#authorsTable tbody tr:nth-child(even) {
  background-color: rgb(10 10 10 / 8%);
}

i.bi {
  font-size: 17px;
  color: white;
  margin: 0 4px;
}
/* Обёртка-переключатель */
.switchm {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 20px;
}

/* Скрываем оригинальный чекбокс */
.switchm input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* Слайдер */
.slider {
  box-shadow: -0.1em -0.1em 0.1em hsl(var(--hue), 10%, 30%) inset, 0.06em 0.06em 0.12em hsla(var(--hue), 10%, 30%), 0.1em 0.1em 0.1em hsl(var(--hue), 10%, 5%) inset, -0.06em -0.06em 0.1em hsla(var(--hue), 10%, 5%);
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc;
  transition: 0.5s;
  border-radius: 34px;
}

/* Круглый бегунок */
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 0px;
  background-color: white;
  transition: 0.5s;
  border-radius: 50%;
}

/* При включении */
.switchm input:checked + .slider {
  background-color: var(--primary-color); /* ← твой стиль */
}

/* Двигаем бегунок */
.switchm input:checked + .slider:before {
  transform: translateX(22px);
}


  /* Стили аккордеона */
td img {
  width: 18px;
  margin: 0px 4px;
}

  h2.toggle {
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    background: var(--primary-color);
    color: #1e1e1e;
    padding: 3px 10px;
    margin: 4px 6px;
    border-radius: 6px;
    user-select: none;
  }

  .cmd-list {
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.3s ease, padding 0.3s ease;
    padding: 0 12px;
    border-left: 2px solid var(--primary-color);
  }

  .cmd-list.open {
    padding: 4px 6px;
    max-height: 1000px; /* Достаточно большое значение для анимации */
  }

  .cmd-row, .cmd-rw {
    display: flex;
    align-items: center;
    margin-bottom: 0px;
  }

  .cmd-col {
    flex: 1 1 150px;
    font-weight: bold;
  }

  .cmd-desc {
    flex: 2 1 300px;
    color: #ccc;
  }


#btnToggleAutoAdd.auto-enabled {
  background-color: #4CAF50 !important; /* зелёный */
  color: white; /* чтобы текст был читаемый */
}


  #playlistControls {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }

  #playlistSelect {
    flex-grow: 1;
    padding: 4px 8px;
  }


  /* Модальное окно */
.modal-bg {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;           /* по умолчанию скрыт */
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-bg.active {
  display: flex;           /* когда активен - показываем */
}

.modal {
  background: #252525;
  padding: 20px;
  border-radius: 8px;
  max-width: 400px;
  width: 90%;
  color: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
}

.modal button {
  width: 24%;
}

  .modal h2 {
    margin-top: 0;
    color: var(--btn-primary-bg-color);
  }

  .modal input {
    width: 100%;
    padding: 8px;
    margin: -8px 0 16px 0;
    border-radius: 4px;
    border: none;
  }

  .modal .buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }  
  
  
#authorsScroll {
  scrollbar-width: thin;
  scrollbar-color: var(--favorites-scrollbar-thumb) var(--favorites-scrollbar-track);
}
#authorsScroll::-webkit-scrollbar {
  width: 8px;
}
#authorsScroll::-webkit-scrollbar-track {
  background: #2b2b2b;
  border-radius: 4px;
}
#authorsScroll::-webkit-scrollbar-thumb {
  background: #ff9900;
  border-radius: 8px;
  border: 2px solid #2b2b2b;
  transition: background 0.2s;
}
#authorsScroll::-webkit-scrollbar-thumb:hover {
  background: #ffaa33;
}


#authorsTableBody {
  scrollbar-width: thin;
  scrollbar-color: var(--favorites-scrollbar-thumb) var(--favorites-scrollbar-track);
}
#authorsTableBody::-webkit-scrollbar {
  width: 8px;
}
#authorsTableBody::-webkit-scrollbar-track {
  background: #2b2b2b;
  border-radius: 4px;
}
#authorsTableBody::-webkit-scrollbar-thumb {
  background: #ff9900;
  border-radius: 8px;
  border: 2px solid #2b2b2b;
  transition: background 0.2s;
}
#authorsTableBody::-webkit-scrollbar-thumb:hover {
  background: #ffaa33;
}



#rolesList {
  scrollbar-width: thin;
  scrollbar-color: var(--favorites-scrollbar-thumb) var(--favorites-scrollbar-track);
}

/* Chrome, Edge, Safari */
#rolesList::-webkit-scrollbar {
  width: 8px;
}

#rolesList::-webkit-scrollbar-track {
  background: #2b2b2b;
  border-radius: 4px;
}

#rolesList::-webkit-scrollbar-thumb {
  background: #ff9900;
  border-radius: 8px;
  border: 2px solid #2b2b2b;
  transition: background 0.2s;
}

#rolesList::-webkit-scrollbar-thumb:hover {
  background: #ffaa33;
}

.favorite-item:hover {
  /* используем переменную с !important */
  box-shadow: 0 0 4px 2px var(--favorite-item-shadow-color) !important;
} 
  
#favoritesList, #MiniList {
  scrollbar-width: thin;
  scrollbar-color: var(--favorites-scrollbar-thumb) var(--favorites-scrollbar-track);
}

/* Chrome, Edge, Safari */
#favoritesList::-webkit-scrollbar {
  width: 8px;
}

#favoritesList::-webkit-scrollbar-track {
  background: #2b2b2b;
  border-radius: 4px;
}

#favoritesList::-webkit-scrollbar-thumb {
  background: #ff9900;
  border-radius: 8px;
  border: 2px solid #2b2b2b;
  transition: background 0.2s;
}

#favoritesList::-webkit-scrollbar-thumb:hover {
  background: #ffaa33;
}


#rewardScripts, #eventScripts {
  scrollbar-width: thin;
  scrollbar-color: var(--favorites-scrollbar-thumb) var(--favorites-scrollbar-track);
}

/* Chrome, Edge, Safari */
#rewardScripts::-webkit-scrollbar,
#eventScripts::-webkit-scrollbar {
  width: 8px;
}

#rewardScripts::-webkit-scrollbar-track,
#eventScripts::-webkit-scrollbar-track {
  background: #2b2b2b;
  border-radius: 4px;
}

#rewardScripts::-webkit-scrollbar-thumb,
#eventScripts::-webkit-scrollbar-thumb {
  background: #ff9900;
  border-radius: 8px;
  border: 2px solid #2b2b2b;
  transition: background 0.2s;
}

#rewardScripts::-webkit-scrollbar-thumb:hover,
#eventScripts::-webkit-scrollbar-thumb:hover {
  background: #ffaa33;
}

  
.form-control {
    box-shadow: -0.2em -0.25em 0.2em hsl(var(--hue), 8%, 22%) inset, 0.06em 0.04em 0.1em hsla(var(--hue), 8%, 32%), 0.1em 0.14em 0.14em hsl(var(--hue), 10%, 5%) inset, -0.06em -0.06em 0.1em hsla(var(--hue), 10%, 5%);
}

* {
	border: 0;
	box-sizing: border-box;
	margin: 0;
	padding: 0;
}
:root {
	--hue: 223;
	--off-hue: 3;
	--on-hue1: 40;
	--on-hue2: 28;
	--fg: hsl(var(--hue),10%,90%);
	--primary: hsl(var(--hue),90%,50%);
	--trans-dur: 0.6s;
	--trans-timing: cubic-bezier(0.65,0,0.35,1);
}
body,
input {
	font: 1em/1.5 sans-serif;
}
body {
  overflow: hidden;
	background-image: linear-gradient(45deg, hsl(223deg 2.38% 16.3%), hsl(223deg 3.76% 7.5%));
	color: var(--fg);
	display: flex;
	height: 120vh;
	transition:
		background-color var(--trans-dur),
		color var(--trans-dur);
}
.switch,
.switch__input {
	-webkit-tap-highlight-color: #0000;
}
.switch {
	display: block;
	margin: auto;
	position: relative;
	width: 5em;
	height: 3em;
}
.switch__base-outer,
.switch__base-inner {
	display: block;
	position: absolute;
}
.switch__base-outer {
	border-radius: 1.25em;
	top: 0.125em;
	left: 0.125em;
	width: 4.75em;
	height: 2.75em;
}
.switch__base-inner {
	border-radius: 1.125em;
	box-shadow:
		-0.25em -0.25em 0.25em hsl(var(--hue),10%,30%) inset,
		0.0625em 0.0625em 0.125em hsla(var(--hue),10%,30%),
		0.125em 0.25em 0.25em hsl(var(--hue),10%,5%) inset,
		-0.0625em -0.0625em 0.125em hsla(var(--hue),10%,5%);
	top: 0.375em;
	left: 0.375em;
	width: 4.25em;
	height: 2.25em;
}
.switch__base-neon {
	display: block;
	overflow: visible;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: auto;
}
.switch__base-neon path {
	stroke-dasharray: 0 104.26 0;
	transition: stroke-dasharray var(--trans-dur) var(--trans-timing);
}
.switch__input {
	outline: transparent;
	position: relative;
	width: 100%;
	height: 100%;
	-webkit-appearance: none;
	appearance: none;
}
.switch__input:before {
	border-radius: 0.125em;
	box-shadow: 0 0 0 0.125em hsla(var(--hue),90%,50%,0);
	content: "";
	display: block;
	position: absolute;
	inset: -0.125em;
	transition: box-shadow 0.15s linear;
}
.switch__input:focus-visible:before {
	box-shadow: 0 0 0 0.125em var(--primary);
}
.switch__knob,
.switch__knob-container {
	border-radius: 1em;
	display: block;
	position: absolute;
}
.switch__knob {
	background-color: hsl(var(--hue),10%,15%);
	background-image:
		radial-gradient(88% 88% at 50% 50%,hsl(var(--hue),0%,25%) 47%,hsla(var(--hue),10%,20%,0) 50%),
		radial-gradient(88% 88% at 47% 47%,hsl(var(--hue),10%,85%) 45%,hsla(var(--hue),10%,85%,0) 50%),
		radial-gradient(65% 70% at 40% 60%,hsl(var(--hue),10%,20%) 46%,hsla(var(--hue),10%,20%,0) 50%);
	box-shadow:
		-0.0625em -0.0625em 0.0625em hsl(var(--hue),10%,15%) inset,
		-0.125em -0.125em 0.0625em hsl(var(--hue),10%,5%) inset,
		0.6em 0.25em 0.125em hsla(0,0%,0%,0.8);
	width: 2em;
	height: 2em;
	transition: transform var(--trans-dur) var(--trans-timing);
}
.switch__knob-container {
	overflow: hidden;
	top: 0.5em;
	left: 0.5em;
	width: 4em;
	height: 2em;
}
.switch__knob-neon {
	display: block;
	width: 2em;
	height: auto;
}
.switch__knob-neon circle {
	opacity: 0;
	stroke-dasharray: 0 90.32 0 54.19;
	transition:
		opacity var(--trans-dur) steps(1,end),
		stroke-dasharray var(--trans-dur) var(--trans-timing);
}
.switch__knob-shadow {
	border-radius: 50%;
	box-shadow: 0.125em 0.125em 0.125em hsla(0,0%,0%,0.9);
	display: block;
	position: absolute;
	top: 0.5em;
	left: 0.5em;
	width: 2em;
	height: 2em;
	transition: transform var(--trans-dur) var(--trans-timing);
}
.switch__led {
	background-color: hsl(var(--off-hue),90%,70%);
	border-radius: 50%;
	box-shadow:
		0 -0.0625em 0.0625em hsl(var(--off-hue),90%,40%) inset,
		0 0 0.125em hsla(var(--off-hue),90%,70%,0.3),
		0 0 0.125em hsla(var(--off-hue),90%,70%,0.3),
		0.125em 0.125em 0.125em hsla(0,0%,0%,0.5);
	display: block;
	position: absolute;
	top: 0;
	left: 0;
	width: 0.25em;
	height: 0.25em;
	transition:
		background-color var(--trans-dur) var(--trans-timing),
		box-shadow var(--trans-dur) var(--trans-timing);
}
.switch__text {
	overflow: hidden;
	position: absolute;
	width: 1px;
	height: 1px;
}
.switch__input:checked ~ .switch__led {
	background-color: hsl(var(--on-hue1),90%,70%);
	box-shadow:
		0 -0.0625em 0.0625em hsl(var(--on-hue1),90%,40%) inset,
		0 -0.125em 0.125em hsla(var(--on-hue1),90%,70%,0.3),
		0 0.125em 0.125em hsla(var(--on-hue1),90%,70%,0.3),
		0.125em 0.125em 0.125em hsla(0,0%,0%,0.5);
}
.switch__input:checked ~ .switch__base-neon path {
	stroke-dasharray: 52.13 0 52.13;
}
.switch__input:checked ~ .switch__knob-shadow,
.switch__input:checked ~ .switch__knob-container .switch__knob {
	transform: translateX(100%);
}
.switch__input:checked ~ .switch__knob-container .switch__knob-neon circle {
	opacity: 1;
	stroke-dasharray: 45.16 0 45.16 54.19;
	transition-timing-function: steps(1,start), var(--trans-timing);
}
  
  
  
  
  
  
input.form-control:focus {
  border-color: var(--input-focus-border-color, var(--primary-color));
  box-shadow: 0 0 0 0.1rem var(--input-focus-border-color, var(--primary-color));
}

.form-control {
    padding: 2px 8px 1px 8px;
    border-bottom-color: rgba(231, 166, 0, 0.2) !important;
}
::placeholder {
  color: rgba(114, 114, 114, 0.6) !important; 
}
.my-4 {
	margin-top: 1.2rem !important;
	margin-bottom: 0rem !important;
	color: #6f6f6f;
}
.mb-3 {
	color: #6f6f6f;
	font-size: 14px;
}
.mb-4 {
    margin-bottom: 0.8rem !important;
}
.pe-3 {
    font-size: 16px;
	font-weight: bold;
}
	
  .queue-mini-content {
  display: flex;
  align-items: center;
  position: relative;
  gap: 10px;
  background-color: #1f1f1f;
  border-radius: 8px;
  padding: 6px;
  transition: background-color 0.2s;
}

.queue-mini-content:hover {
  background-color: #2a2a2a;
}

.queue-mini-fav-btn {
  position: absolute;
  top: 6px;
  right: 6px;
  width: 22px;
  height: 22px;
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  display: none;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s;
}

.queue-mini-content:hover .queue-mini-fav-btn {
  display: flex;
}

.queue-mini-fav-btn:hover {
  background-color: rgba(255, 255, 255, 0.3);
}

.queue-mini-fav-btn span {
  color: white;
  font-size: 14px;
  font-weight: bold;
}
  
  .queue-item .plus-btn {
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .queue-item:hover .plus-btn {
    opacity: 1;
  }
  

  
.favorite-item {
  padding: 2px 8px;
  border-bottom: 1px solid #333;
  color: #fff;
  transition: background-color 0.2s;
  font-size: 14px;
  cursor: pointer;
}

.favorite-item:hover {
  background-color: #333333;
  color: var(--favorite-item-hover-color);
}

.favorite-item-hovered {
  box-shadow: 0 0 4px 2px var(--favorite-item-shadow-color);
  background-color: #2a2a2a;
}

  
  .queue-item {
    position: relative;
    transition: background-color 0.2s ease;
  }

  .queue-item:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .queue-item .add-btn {
    position: absolute;
    top: 4px;
    right: 6px;
    background: #ffffff;
    color: #000000;
    font-weight: bold;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    text-align: center;
    line-height: 18px;
    font-size: 13px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .queue-item:hover .add-btn {
    opacity: 1;
  }
   
  
.window-controls {
	position: absolute;
    top: 8px;
    right: 14px;
    display: flex;
    gap: 0px;
    z-index: 999;
}

.window-btn {
  position: relative;
  width: 32px;
  height: 30px;
  border-radius: 50%;
  background: #333;
  border: none;
  cursor: pointer;
  transition: 0.3s;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.window-btn img {
  width: 21px;
  height: 21px;
  pointer-events: none;
  filter: brightness(0) invert(1);
  transition: 0.3s;
}

.window-btn::before {
  content: "";
  position: absolute;
  width: 62%;
  height: 62%;
  background: var(--primary-color);
  border-radius: 50%;
  transform: scale(0.9);
  transition: 0.3s;
  z-index: -1;
  opacity: 0;
}

.window-btn:hover::before {
  transform: scale(1.1);
  box-shadow: 0 0 15px var(--primary-color);
  opacity: 1;
}

.window-btn:hover img {
  filter: brightness(1);
}


  
.pywebview-drag-region {
    -webkit-app-region: drag;
    background: transparent; /* Можно сделать невидимой */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 9998;
}
  
  /* Кастомные кнопки окна */
.navbar {
  -webkit-app-region: drag;
  user-select: none;
}

.window-btn {
  -webkit-app-region: no-drag;
  background-color: transparent;
  border: none;
  color: white;
  font-size: 18px;
  margin-left: 5px;
  cursor: pointer;
   z-index: 9999;
}
.window-btn:hover {
  color: #ff4d4d;
}
  
  
  
button {
  margin: 0px;
}
.custom-btn {
  width: 110px;
  height: 40px;
  border-radius: 6px;
  padding: 2px 2px;
  font-family: 'Lato', sans-serif;
  font-weight: 700;
  background: transparent;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  display: inline-block;
   box-shadow:inset 2px 2px 2px 0px rgba(255,255,255,.5),
   7px 7px 20px 0px rgba(0,0,0,.1),
   4px 4px 5px 0px rgba(0,0,0,.1);
  outline: none;
}
  

/* 16 */
.btn-16 {
  border: none;
  background: var(--btn-16-background);
  color: #000;
}
.btn-16:after {
  background: var(--btn-16-after-background);
  position: absolute;
  content: "";
  width: 0;
  height: 100%;
  top: 0;
  left: 0;
  direction: rtl;
  z-index: -1;
  box-shadow:
   -7px -7px 20px 0px #fff9,
   -4px -4px 5px 0px #fff9,
   7px 7px 20px 0px #0002,
   4px 4px 5px 0px #0001;
  transition: all 0.3s ease;
}
.btn-16:hover {
  color: #000;
}
.btn-16:hover:after {
  left: auto;
  right: 0;
  width: 100%;
}


.btn .btn-primary .btn-round .custom-btn .btn-16 {
  color: black;
}
  
  .centry {
    border-radius: 0.2rem;
    line-height: 1.2;
    display: inline;
    font-size: 1rem;
    padding: 2px 8px 1px 8px;
}
  
    /* Стили для ползунка */
    input[type="range"] {
	box-shadow: -0.15em -0.15em 0.15em hsl(223deg 3.65% 18.13%) inset, 0.06em 0.06em 0.8px 0.1em hsl(0deg 0% 12.08%), 0.1em 0.15em 0.15em hsl(0deg 0% 11.18%) inset, -0.06em -0.06em 0.1em hsl(0deg 0% 10.5%);
    position: relative;
    top: 2px;
      width: 100%;
      height: 15px;
      background: linear-gradient(to right, var(--range-start-color), var(--range-end-color));
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      transition: background 0.3s ease-in-out;
    }

    /* Стили для ползунка при наведении */
    input[type="range"]:hover {
      background:  linear-gradient(to right, var(--range-start-color), var(--range-end-color));
    }

    /* Стили для ползунка на вебкит-браузерах */
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 21px;
      height: 21px;
      background: linear-gradient(to right, var(--range-start-color), var(--range-end-color));
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      transition: background 0.3s ease;
    }

    /* Стили для ползунка на Firefox */
    input[type="range"]::-moz-range-thumb {
      width: 21px;
      height: 21px;
      background: linear-gradient(to right, var(--range-start-color), var(--range-end-color));
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      transition: background 0.3s ease;
    }

    /* Стили для ползунка на фокус */
    input[type="range"]:focus {
      background: linear-gradient(to right, var(--range-start-color), var(--range-end-color));
    }

    /* Стили для ползунка на активном состоянии */
    input[type="range"]:active {
      background: linear-gradient(to right, var(--range-start-color), var(--range-end-color));
    }
	
select {
    width: 100%;
    background: #2a2a2a;
    color: white;
    box-shadow: -0.2em -0.25em 0.2em hsl(var(--hue), 8%, 22%) inset, 0.06em 0.04em 0.1em hsla(var(--hue), 8%, 32%), 0.1em 0.14em 0.14em hsl(var(--hue), 10%, 5%) inset, -0.06em -0.06em 0.1em hsla(var(--hue), 10%, 5%);
}

  .cmd-list {
    font-family: monospace, monospace;
    color: white;
    padding: 0px 2px;
    border-radius: 8px;
  }
  .cmd-row {
    display: grid;
    grid-template-columns: 77px 77px 81px 1fr;/* 3 команды + описание */
    column-gap: 12px;
    padding: 0px 0;
    align-items: center;
    border-bottom: 1px solid #444;
  }
  .cmd-row:last-child {
    border-bottom: none;
  }
  .cmd-ro {
    display: grid;
    grid-template-columns: 260px 1fr;/* 3 команды + описание */
    column-gap: 12px;
    padding: 0px 0;
    align-items: center;
    border-bottom: 1px solid #444;
  }
  .cmd-ro:last-child {
    border-bottom: none;
  }
  .cmd-rw {
    display: grid;
    grid-template-columns: 260px 1fr;/* 3 команды + описание */
    column-gap: 12px;
    padding: 0px 0;
    align-items: center;
    border-bottom: 1px solid #444;
  }
  .cmd-rw:last-child {
    border-bottom: none;
  }
  .cmd-col {
    font-weight: bold;
    color: #fff;
    white-space: nowrap;
  }
  .cmd-desc {
    color: #ccc;
  }
  </style>
  

</body>
</html>
